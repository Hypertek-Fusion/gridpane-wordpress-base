document.addEventListener("DOMContentLoaded",function(){const a=new URLSearchParams(window.location.search);a.get("page")&&a.get("page")==="hypersite-reviews-setup"&&m()});function u(a){return HSRevApi.urls.accountLocationsBase.replace("%s",a)}let v=1,d=10;window.HSRevData=window.HSRevData||{};window.HSRevData.data=window.HSRevData.data||{};window.HSRevData.data.selectedReviews=new Set;const m=async()=>{try{const a=document.getElementById("account-rows");a.innerHTML="";const e=document.createElement("div");e.style.textAlign="center",e.innerText="Fetching accounts. Please wait ...",e.classList.add("account-row-item"),a.appendChild(e);const t=await fetch(HSRevApi.urls.accounts,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":HSRevApi.nonce}});if(!t.ok)throw new Error("Network response was not ok "+t.statusText);const o=await t.json();console.log(o),R(o)}catch(a){console.error("There was a problem with the fetch operation:",a)}},R=async a=>{const e=document.getElementById("account-rows"),t=[];await Promise.all(a.accounts.map(async o=>{const n=o.account_id,c=await y(n);if(c>0){const i=document.createElement("div");i.classList.add("rows"),i.innerHTML=`
                <div class="row-item" data-account-id="${n}">
                    <input type="checkbox" name="selected-account" value="${n}">
                    <div class="row-item__cell" data-type="name">${n}</div>
                    <div class="row-item__cell" data-type="account-name">${o.account_name}</div>
                    <div class="row-item__cell" data-type="type">${o.type}</div>
                    <div class="row-item__cell" data-type="location-count">${c}</div>
                </div>
            `,t.push(i)}})),e.innerHTML="",e.append(...t),window.HSRevData.functions.attachCheckboxListeners&&window.HSRevData.functions.attachCheckboxListeners(e)},y=async a=>{try{const e=HSRevApi.urls.totalAccountLocations.replace("%s",a.replace("accounts/","")),t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":HSRevApi.nonce}});if(!t.ok)throw new Error("Network response was not ok "+t.statusText);const o=await t.json();return console.log("Location length data:",o),o.total||0}catch(e){console.error("There was a problem with the fetch operation:",e)}},H=async a=>{const e=document.getElementById("location-rows"),t=window.HSRevData.data.locationsCache||{};if(t[a]){console.log("Using cached locations"),p(t[a]);return}e.innerHTML='<div style="text-align: center;" class="row-item">Fetching locations. Please wait ...</div>';try{const o=u(a.replace("accounts/","")),n=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":HSRevApi.nonce}});if(!n.ok)throw new Error("Network response was not ok "+n.statusText);const c=await n.json();t[a]=c,window.HSRevData.data.locationsCache=t,console.log("Locations for Account:",c),p(c)}catch(o){console.error("There was a problem with the fetch operation:",o),e.innerHTML='<div style="text-align: center;" class="row-item">Error fetching locations. Please try again later.</div>'}},p=async a=>{const e=document.getElementById("location-rows"),t=[],o=a.locations;await Promise.all(o.map(async n=>{if(window.HSRevData.data.accountId){const c=await g(window.HSRevData.data.accountId,n.location_id),i=document.createElement("div");i.classList.add("rows"),i.innerHTML=`
                <div class="row-item" data-location-id="${n.location_id}">
                    <input type="checkbox" name="selected-location" value="${n.location_id}">
                    <div class="row-item__cell" data-type="id">${n.location_id}</div>
                    <div class="row-item__cell" data-type="name">${n.title}</div>
                    <div class="row-item__cell" data-type="review-count">${c}</div>
                </div>
            `,t.push(i)}})),e.innerHTML="",e.append(...t),window.HSRevData.functions.attachCheckboxListeners&&window.HSRevData.functions.attachCheckboxListeners(e)},g=async(a,e)=>{try{const t=HSRevApi.urls.totalLocationReviews.replace("%s",a.replace("accounts/","")).replace("%s",e.replace("locations/","")),o=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":HSRevApi.nonce}});if(!o.ok)throw new Error("Network response was not ok "+o.statusText);return(await o.json()).total||0}catch(t){console.error("There was a problem with the fetch operation:",t)}},f=async a=>{try{let e=[],t=1;for(;;){const o=`${HSRevApi.urls.locationReviewsBase.replace("%s",a.replace("locations/",""))}?page=${t}&per_page=${d}`,n=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":HSRevApi.nonce}});if(!n.ok)throw new Error("Network response was not ok "+n.statusText);const c=await n.json();if(e=e.concat(c.reviews),c.reviews.length<d)break;t++}window.HSRevData.data.reviewsCache=window.HSRevData.data.reviewsCache||{},window.HSRevData.data.reviewsCache[a]=e,console.log("All Reviews for Location (prefetched):",e),v=1,S(v,d)}catch(e){console.error("There was a problem with the fetch operation:",e)}},S=(a,e)=>{const t=document.getElementById("review-rows"),o=window.HSRevData.data.locationId,n=window.HSRevData.data.reviewsCache[o]||[],c=(a-1)*e,i=c+e,r=n.slice(c,i),h=r.map(s=>{const l=window.HSRevData.data.selectedReviews.has(s.review_id),w=document.createElement("div");return w.classList.add("rows"),w.innerHTML=`
            <div class="row-item">
                <input type="checkbox" name="selected-review-${s.review_id}" value="${s.review_id}" ${l?"checked":""}>
                <div class="row-item__cell" data-type="reviewer">${s.reviewer_display_name}</div>
                <div class="row-item__cell" data-type="rating">${s.star_rating}</div>
                <div class="row-item__cell" data-type="comment">${s.comment}</div>
                <div class="row-item__cell" data-type="date">${new Date(s.create_time).toLocaleDateString()}</div>
            </div>
        `,w});if(t.innerHTML="",t.append(...h),window.HSRevData.functions.selectAllReviews){const s=document.getElementById("select-all-reviews");s.checked=r.every(l=>window.HSRevData.data.selectedReviews.has(l.review_id)),s.addEventListener("change",()=>{selectAllReviews(s,r),window.HSRevData.functions.attachCheckboxListeners(t)})}};window.HSRevData=window.HSRevData||{};window.HSRevData.functions=window.HSRevData.functions||{};window.HSRevData.functions.getLocations=H;window.HSRevData.functions.prefetchReviews=f;
//# sourceMappingURL=admin.js.map
