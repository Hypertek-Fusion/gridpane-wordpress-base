{"version":3,"file":"forms.js","sources":["../admin/js/forms.js"],"sourcesContent":["let pages = null; \nlet currentPage = 0;\nlet reviewsPerPage = 10; // Default reviews per page\nlet prevButton = null;\nlet nextButton = null;\n\nconst isSetupPage = () => {\n    return new URLSearchParams(document.location.search).get('page') === 'hypersite-reviews-setup'\n}\n\ndocument.addEventListener('reviewsInitialized', () => {\n    \n    if(isSetupPage()) {\n        pages = document.querySelectorAll('.setup-page')\n    } else {\n        pages = document.querySelectorAll('.reviews-page')\n    }\n    prevButton = document.querySelector('.page-prev');\n    nextButton = document.querySelector('.page-next');\n\n    // Initialize window.HSRevData if not already done\n    window.HSRevData = window.HSRevData || {};\n    window.HSRevData.functions = window.HSRevData.functions || {};\n    window.HSRevData.data = window.HSRevData.data || {};\n    window.HSRevData.data.selectedReviews = new Set();\n\n    // Prevent default form submission\n    const form = document.querySelector('form');\n    form.addEventListener('submit', (e) => {\n        e.preventDefault(); // Prevents the form from being submitted\n        submitForm(); // Handle form submission\n    });\n\n    const getCheckedAccountId = () => {\n        const selectedCheckbox = pages[0].querySelector('input[type=\"checkbox\"]:checked');\n        if (selectedCheckbox) {\n            return selectedCheckbox.closest('.row-item').dataset.accountId;\n        }\n        return null;\n    };\n\n    const getCheckedLocationId = () => {\n        const selectedCheckbox = pages[1].querySelector('input[type=\"checkbox\"]:checked');\n        if (selectedCheckbox) {\n            return selectedCheckbox.closest('.row-item').dataset.locationId;\n        }\n        return null;\n    };\n\n    const attachCheckboxListeners = (container) => {\n        const checkboxes = container.querySelectorAll('input[type=\"checkbox\"]');\n        checkboxes.forEach(c => {\n            c.addEventListener('change', e => {\n                const clickedCheckbox = e.target;\n                const reviewId = clickedCheckbox.value;\n                if (clickedCheckbox.checked) {\n                    window.HSRevData.data.selectedReviews.add(reviewId);\n                } else {\n                    window.HSRevData.data.selectedReviews.delete(reviewId);\n                }\n                updateHiddenInput();\n                updateButtonState();\n            });\n        });\n    };\n\n    const showPage = (index) => {\n        pages.forEach((page, i) => {\n            page.style.display = i === index ? 'block' : 'none';\n        });\n\n        prevButton.disabled = index === 0;\n        updateButtonState();\n    };\n\n    showPage(currentPage);\n\n    prevButton.addEventListener('click', () => {\n        if (currentPage > 0) {\n            currentPage--;\n            showPage(currentPage);\n        }\n    });\n\n    nextButton.addEventListener('click', () => {\n        if(isSetupPage()) {\n            if (currentPage < pages.length - 1 && isAnyCheckboxCheckedOnCurrentPage()) {\n                if (currentPage === 0) {\n                    const accountId = getCheckedAccountId();\n                    if (accountId && window.HSRevData.functions.getLocations) {\n                        if (window.HSRevData.data.accountId !== accountId) {\n                            console.log('Account changed, clearing location cache');\n                            window.HSRevData.data.locationsCache = {};\n                        }\n                        window.HSRevData.functions.getLocations(accountId);\n                        window.HSRevData.data.accountId = accountId;\n                        console.log(`Account ID set: ${accountId}`);\n                    }\n                } else if (currentPage === 1) {\n                    const locationId = getCheckedLocationId();\n                    if (locationId && window.HSRevData.functions.prefetchReviews) {\n                        if (window.HSRevData.data.locationId !== locationId) {\n                            console.log('Location changed, clearing review cache');\n                            window.HSRevData.data.reviewsCache = {};\n                        }\n                        window.HSRevData.functions.prefetchReviews(locationId);\n                        window.HSRevData.data.locationId = locationId;\n                        console.log(`Location ID set: ${locationId}`);\n                    }\n                }\n                currentPage++;\n                showPage(currentPage);\n            } else if (currentPage === 2 && isAnyCheckboxCheckedOnCurrentPage()) {\n                form.submit(); // Only submit the form when on the last page\n            }\n        } else {\n            currentPage++;\n            showPage(currentPage);\n        }\n\n    });\n\n    if (window.HSRevData && window.HSRevData.functions) {\n        window.HSRevData.functions.attachCheckboxListeners = attachCheckboxListeners;\n        window.HSRevData.functions.selectAllReviews = selectAllReviews;\n    }\n\n    if (pages[currentPage]) {\n        attachCheckboxListeners(pages[currentPage]);\n    }\n\n    // Pagination Functions\n    const reviewsPerPageSelect = document.getElementById('reviews-per-page');\n\n\n    const changePage = (newPage) => {\n        const totalPages = Math.ceil(getTotalItems() / reviewsPerPage);\n        if (newPage > 0 && newPage <= totalPages) {\n            currentPage = newPage;\n            showPageReviews(currentPage);\n        }\n    };\n\n    document.getElementById('page-prev').addEventListener('click', () => changePage(currentPage - 1));\n    document.getElementById('page-next').addEventListener('click', () => changePage(currentPage + 1));\n    reviewsPerPageSelect.addEventListener('change', function () {\n        reviewsPerPage = parseInt(this.value, 10);\n        currentPage = 1; // Reset to first page on perPage change\n        showPageReviews(currentPage);\n    });\n\n    showPageReviews(currentPage);\n});\n\nconst updatePaginationControls = (totalItems, currentPage, itemsPerPage) => {\n    const totalPages = Math.ceil(totalItems / itemsPerPage);\n    document.getElementById('page-prev').disabled = currentPage <= 1;\n    document.getElementById('page-next').disabled = currentPage >= totalPages;\n};\n\nconst showPageReviews = (page) => {\n    const pages = document.querySelectorAll('.reviews-page');\n    pages.forEach((pageElement, index) => {\n        pageElement.style.display = (index + 1 === page) ? 'block' : 'none';\n    });\n\n    updatePaginationControls(getTotalItems(), currentPage, reviewsPerPage);\n};\n\nconst getTotalItems = () => {\n    return document.querySelectorAll('.review-row').length;\n};\n\nconst selectAllReviews = (element) => {\n    const reviewCheckboxes = pages[currentPage].querySelectorAll('input[name*=\"selected-review-\"][type=\"checkbox\"]');\n    const locationId = window.HSRevData.data.locationId;\n    const reviews = window.HSRevData.data.reviewsCache[locationId] || [];\n\n    Array.from(reviewCheckboxes).forEach(cb => {\n        const reviewId = cb.value;\n        cb.checked = element.checked;\n        if (element.checked) {\n            window.HSRevData.data.selectedReviews.add(reviewId);\n        } else {\n            window.HSRevData.data.selectedReviews.delete(reviewId);\n        }\n    });\n\n    updateHiddenInput();\n    updateButtonState();\n};\n\nconst updateHiddenInput = () => {\n    const hiddenInput = document.getElementById('selected_reviews');\n    const filteredReviewIds = Array.from(window.HSRevData.data.selectedReviews).filter(id => id.startsWith('AbFvOq'));\n    hiddenInput.value = filteredReviewIds.join(',');\n};\n\nconst updateButtonState = () => {\n    if(isSetupPage) {\n        if (currentPage !== 2) {\n            nextButton.innerText = 'Next Page';\n        } else {\n            nextButton.innerText = 'Submit';\n        }\n        nextButton.disabled = !isAnyCheckboxCheckedOnCurrentPage();\n    } else {\n        nextButton.disabled = currentPage === pages.length - 1\n    }\n\n};\n\nconst isAnyCheckboxCheckedOnCurrentPage = () => {\n    console.log(pages)\n    const currentCheckboxes = pages[currentPage].querySelectorAll('input:not([name=\"select-all-reviews\"])[type=\"checkbox\"]');\n    return Array.from(currentCheckboxes).some(cb => cb.checked);\n};\n\nexport { updatePaginationControls, changePage, showPageReviews, selectAllReviews, updateButtonState };\n"],"names":["pages","currentPage","reviewsPerPage","prevButton","nextButton","isSetupPage","form","getCheckedAccountId","selectedCheckbox","getCheckedLocationId","attachCheckboxListeners","container","c","e","clickedCheckbox","reviewId","updateHiddenInput","updateButtonState","showPage","index","page","i","isAnyCheckboxCheckedOnCurrentPage","accountId","locationId","selectAllReviews","reviewsPerPageSelect","changePage","newPage","totalPages","getTotalItems","showPageReviews","updatePaginationControls","totalItems","itemsPerPage","pageElement","element","reviewCheckboxes","cb","hiddenInput","filteredReviewIds","id","currentCheckboxes"],"mappings":"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"}