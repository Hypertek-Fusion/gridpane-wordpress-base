{"version":3,"file":"mainPage.js","sources":["../admin/js/main-page.js"],"sourcesContent":["import { updatePaginationControls, showPageReviews, updateButtonState } from './forms.js';\n\nconst reviewsInitializedEvent = new Event('reviewsInitialized');\n\ndocument.addEventListener('DOMContentLoaded', async () => {\n    const getSelectedLocation = () => {\n        return new Promise(async (resolve, reject) => {\n            const response = await fetch(window.HSRevApi.urls.selectedLocation, {\n                method: 'GET',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'X-WP-Nonce': HSRevApi.nonce\n                }\n            });\n\n            if (!response.ok) {\n                reject('Network response was not ok ' + response.statusText);\n            }\n\n            const locationsData = await response.json();\n            resolve(locationsData);\n        });\n    };\n\n    const getSelectedLocationReviews = (locationId, page = 1) => {\n        return new Promise(async (resolve, reject) => {\n            let reviewsBatch = [];\n            let totalPages = 1;\n\n            do {\n                const response = await fetch(window.HSRevApi.urls.locationReviewsBase.replace('locations/%s', locationId) + '?' + new URLSearchParams({\n                    'per_page': 100,\n                    'page': page\n                }), {\n                    method: 'GET',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-WP-Nonce': HSRevApi.nonce\n                    }\n                });\n\n                if (!response.ok) {\n                    reject('Network response was not ok ' + response.statusText);\n                }\n\n                const reviews = await response.json();\n                totalPages = reviews['total_pages'];\n\n                reviews['reviews'].forEach(r => {\n                    reviewsBatch.push(r);\n                });\n\n                page++;\n            } while (page <= totalPages);\n\n            resolve(reviewsBatch);\n        });\n    };\n\n    const firstReviewPage = document.getElementById('initial-reviews');\n    const reviewsTable = document.getElementById('reviews-table');\n    const reviewsPerPageSelect = document.getElementById('reviews-per-page');\n\n    if (window.HSRevApi) {\n        try {\n            const data = await getSelectedLocation();\n            const locID = data['location_id'];\n            const reviews = await getSelectedLocationReviews(locID);\n\n            const rpp = parseInt(reviewsPerPageSelect.selectedOptions[0].value, 10);\n            console.log(reviews);\n\n            firstReviewPage.innerHTML = '';\n\n            const numPages = Math.ceil(reviews.length / rpp);\n\n            for (let i = 0; i < numPages; i++) {\n                const isFirstPage = i === 0;\n                const page = isFirstPage ? firstReviewPage : document.createElement('div');\n                const row = document.createElement('div');\n                row.classList.add('rows');\n\n                page.setAttribute('data-page', i + 1);\n                page.classList.add('reviews-page');\n\n                for (let j = 0; j < rpp; j++) {\n                    const review = reviews[(i * rpp) + j];\n                    if (!review) continue;\n\n                    row.innerHTML += `\n                        <div class=\"row-item review-row\">\n                            <input type=\"checkbox\" name=\"selected-review-${review.review_id}\" value=\"${review.review_id}\" ${parseInt(review.is_selected) ? 'checked' : ''}>\n                            <div class=\"row-item__cell\" data-type=\"reviewer\">${review.reviewer_display_name}</div>\n                            <div class=\"row-item__cell\" data-type=\"rating\">${review.star_rating}</div>\n                            <div class=\"row-item__cell\" data-type=\"comment\">${review.comment}</div>\n                            <div class=\"row-item__cell\" data-type=\"date\">${new Date(review.create_time).toLocaleDateString()}</div>\n                        </div>\n                    `;\n\n                    page.appendChild(row);\n                }\n\n                if (!isFirstPage) {\n                    reviewsTable.appendChild(page);\n                }\n\n            }\n\n            document.dispatchEvent(reviewsInitializedEvent);\n\n            updatePaginationControls(reviews.length, 1, rpp);\n            showPageReviews(1);\n            updateButtonState();\n\n        } catch (e) {\n            console.error('Error with promise: ', e);\n        }\n    }\n});\n"],"names":["reviewsInitializedEvent","getSelectedLocation","resolve","reject","response","locationsData","getSelectedLocationReviews","locationId","page","reviewsBatch","totalPages","reviews","firstReviewPage","reviewsTable","reviewsPerPageSelect","locID","rpp","numPages","i","isFirstPage","row","j","review","updatePaginationControls","showPageReviews","updateButtonState","e"],"mappings":"6CAEA,MAAMA,EAA0B,IAAI,MAAM,oBAAoB,EAE9D,SAAS,iBAAiB,mBAAoB,SAAY,CACtD,MAAMC,EAAsB,IACjB,IAAI,QAAQ,MAAOC,EAASC,IAAW,CAC1C,MAAMC,EAAW,MAAM,MAAM,OAAO,SAAS,KAAK,iBAAkB,CAChE,OAAQ,MACR,QAAS,CACL,eAAgB,mBAChB,aAAc,SAAS,KAC3C,CACA,CAAa,EAEIA,EAAS,IACVD,EAAO,+BAAiCC,EAAS,UAAU,EAG/D,MAAMC,EAAgB,MAAMD,EAAS,KAAM,EAC3CF,EAAQG,CAAa,CACjC,CAAS,EAGCC,EAA6B,CAACC,EAAYC,EAAO,IAC5C,IAAI,QAAQ,MAAON,EAASC,IAAW,CAC1C,IAAIM,EAAe,CAAE,EACjBC,EAAa,EAEjB,EAAG,CACC,MAAMN,EAAW,MAAM,MAAM,OAAO,SAAS,KAAK,oBAAoB,QAAQ,eAAgBG,CAAU,EAAI,IAAM,IAAI,gBAAgB,CAClI,SAAY,IACZ,KAAQC,CAC5B,CAAiB,EAAG,CACA,OAAQ,MACR,QAAS,CACL,eAAgB,mBAChB,aAAc,SAAS,KAC/C,CACA,CAAiB,EAEIJ,EAAS,IACVD,EAAO,+BAAiCC,EAAS,UAAU,EAG/D,MAAMO,EAAU,MAAMP,EAAS,KAAM,EACrCM,EAAaC,EAAQ,YAErBA,EAAQ,QAAW,QAAQ,GAAK,CAC5BF,EAAa,KAAK,CAAC,CACvC,CAAiB,EAEDD,GACH,OAAQA,GAAQE,GAEjBR,EAAQO,CAAY,CAChC,CAAS,EAGCG,EAAkB,SAAS,eAAe,iBAAiB,EAC3DC,EAAe,SAAS,eAAe,eAAe,EACtDC,EAAuB,SAAS,eAAe,kBAAkB,EAEvE,GAAI,OAAO,SACP,GAAI,CAEA,MAAMC,GADO,MAAMd,EAAqB,GACrB,YACbU,EAAU,MAAML,EAA2BS,CAAK,EAEhDC,EAAM,SAASF,EAAqB,gBAAgB,CAAC,EAAE,MAAO,EAAE,EACtE,QAAQ,IAAIH,CAAO,EAEnBC,EAAgB,UAAY,GAE5B,MAAMK,EAAW,KAAK,KAAKN,EAAQ,OAASK,CAAG,EAE/C,QAASE,EAAI,EAAGA,EAAID,EAAUC,IAAK,CAC/B,MAAMC,EAAcD,IAAM,EACpBV,EAAOW,EAAcP,EAAkB,SAAS,cAAc,KAAK,EACnEQ,EAAM,SAAS,cAAc,KAAK,EACxCA,EAAI,UAAU,IAAI,MAAM,EAExBZ,EAAK,aAAa,YAAaU,EAAI,CAAC,EACpCV,EAAK,UAAU,IAAI,cAAc,EAEjC,QAASa,EAAI,EAAGA,EAAIL,EAAKK,IAAK,CAC1B,MAAMC,EAASX,EAASO,EAAIF,EAAOK,CAAC,EAC/BC,IAELF,EAAI,WAAa;AAAA;AAAA,2EAEsCE,EAAO,SAAS,YAAYA,EAAO,SAAS,KAAK,SAASA,EAAO,WAAW,EAAI,UAAY,EAAE;AAAA,+EAC1FA,EAAO,qBAAqB;AAAA,6EAC9BA,EAAO,WAAW;AAAA,8EACjBA,EAAO,OAAO;AAAA,2EACjB,IAAI,KAAKA,EAAO,WAAW,EAAE,mBAAkB,CAAE;AAAA;AAAA,sBAIxGd,EAAK,YAAYY,CAAG,EACxC,CAEqBD,GACDN,EAAa,YAAYL,CAAI,CAGjD,CAEY,SAAS,cAAcR,CAAuB,EAE9CuB,EAAyBZ,EAAQ,OAAQ,EAAGK,CAAG,EAC/CQ,EAAgB,CAAC,EACjBC,EAAmB,CAEtB,OAAQC,EAAG,CACR,QAAQ,MAAM,uBAAwBA,CAAC,CACnD,CAEA,CAAC"}