const l=document.getElementById("initial-reviews"),d=document.getElementById("reviews-table"),w=document.getElementById("reviews-per-page"),p=()=>new Promise(async(t,e)=>{const s=await fetch(window.HSRevApi.urls.selectedLocation,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":HSRevApi.nonce}});s.ok||e("Network response was not ok "+s.statusText);const n=await s.json();t(n)}),v=(t,e=1)=>new Promise(async(s,n)=>{let r=[],i=1;do{const a=await fetch(window.HSRevApi.urls.locationReviewsBase.replace("locations/%s",t)+"?"+new URLSearchParams({per_page:100,page:e}),{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":HSRevApi.nonce}});a.ok||n("Network response was not ok "+a.statusText);const c=await a.json();i=c.total_pages,c.reviews.forEach(o=>{r.push(o)}),e++}while(e<=i);s(r)});document.addEventListener("DOMContentLoaded",async()=>{window.HSRevApi&&p().then(t=>{const e=t.location_id;return v(e)}).then(t=>{const e=parseInt(w.selectedOptions[0].value);console.log(t),l.innerHTML="";const s=Math.ceil(t.length/e);for(let n=0;n<s;n++){const r=n===0,i=r?l:document.createElement("div"),a=document.createElement("div");a.classList.add("rows"),i.setAttribute("data-page",n+1),i.classList.add("reviews-page");for(let c=0;c<e;c++){const o=t[n*e+c];o&&(console.log("Review #: ",n*e+c),console.log("Review Object: ",o),a.innerHTML+=`
                        <div class="row-item">
                            <input type="checkbox" name="selected-review-${o.review_id}" value="${o.review_id}" ${parseInt(o.is_selected)?"checked":""}>
                            <div class="row-item__cell" data-type="reviewer">${o.reviewer_display_name}</div>
                            <div class="row-item__cell" data-type="rating">${o.star_rating}</div>
                            <div class="row-item__cell" data-type="comment">${o.comment}</div>
                            <div class="row-item__cell" data-type="date">${new Date(o.create_time).toLocaleDateString()}</div>
                        </div>
                    `,i.appendChild(a))}if(!r)d.appendChild(i);else continue}updatePaginationControls(t.length,1,e),showPageReviews(1)}).catch(t=>{console.error("Error with promise: ",t)})});
