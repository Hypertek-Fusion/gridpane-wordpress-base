const d=()=>new Promise(async(s,e)=>{const t=await fetch(window.HSRevApi.urls.selectedLocation,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":HSRevApi.nonce}});t.ok||e("Network response was not ok "+t.statusText);const r=await t.json();s(r)}),w=(s,e=1)=>new Promise(async(t,r)=>{let o=[],l=1;do{const i=await fetch(window.HSRevApi.urls.locationReviewsBase.replace("locations/%s",s)+"?"+new URLSearchParams({per_page:100,page:e}),{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":HSRevApi.nonce}});i.ok||r("Network response was not ok "+i.statusText);const a=await i.json();l=a.total_pages,a.reviews.forEach(c=>{o.push(c)}),e++}while(e<=l);t(o)});document.addEventListener("DOMContentLoaded",async()=>{const s=document.getElementById("initial-reviews");window.HSRevApi&&d().then(e=>{const t=e.location_id;return w(t)}).then(e=>{const t=parseInt(reviewsPerPageSelect.selectedOptions[0].value);console.log(e),s.innerHTML="";const r=Math.ceil(e.length/t);for(let o=0;o<r;o++){const l=o===0,i=l?s:document.createElement("div"),a=document.createElement("div");a.classList.add("rows"),i.setAttribute("data-page",o+1),i.classList.add("reviews-page");for(let c=0;c<t;c++){const n=e[o*t+c];n&&(console.log("Review #: ",o*t+c),console.log("Review Object: ",n),a.innerHTML+=`
                        <div class="row-item">
                            <input type="checkbox" name="selected-review-${n.review_id}" value="${n.review_id}" ${parseInt(n.is_selected)?"checked":""}>
                            <div class="row-item__cell" data-type="reviewer">${n.reviewer_display_name}</div>
                            <div class="row-item__cell" data-type="rating">${n.star_rating}</div>
                            <div class="row-item__cell" data-type="comment">${n.comment}</div>
                            <div class="row-item__cell" data-type="date">${new Date(n.create_time).toLocaleDateString()}</div>
                        </div>
                    `,i.appendChild(a))}if(!l)reviewsTable.appendChild(i);else continue}updatePaginationControls(e.length,1,t),showPageReviews(1)}).catch(e=>{console.error("Error with promise: ",e)})});
