document.addEventListener("DOMContentLoaded",async()=>{const p=()=>new Promise(async(e,t)=>{const i=await fetch(window.HSRevApi.urls.selectedLocation,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":HSRevApi.nonce}});i.ok||t("Network response was not ok "+i.statusText);const o=await i.json();e(o)}),v=(e,t=1)=>new Promise(async(i,o)=>{let l=[],n=1;do{const c=await fetch(window.HSRevApi.urls.locationReviewsBase.replace("locations/%s",e)+"?"+new URLSearchParams({per_page:100,page:t}),{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":HSRevApi.nonce}});c.ok||o("Network response was not ok "+c.statusText);const a=await c.json();n=a.total_pages,a.reviews.forEach(r=>{l.push(r)}),t++}while(t<=n);i(l)}),w=document.getElementById("initial-reviews");window.HSRevApi&&p().then(e=>{const t=e.location_id;return v(t)}).then(e=>{const t=document.getElementById("reviews-table"),i=document.getElementById("reviews-per-page"),o=parseInt(i.selectedOptions[0].value);console.log(e),w.innerHTML="";const l=Math.ceil(e.length/o);for(let n=0;n<l;n++){const c=n===0,a=c?w:document.createElement("div"),r=document.createElement("div");r.classList.add("rows"),a.setAttribute("data-page",n+1),a.classList.add("reviews-page");for(let d=0;d<o;d++){const s=e[n*o+d];s&&(console.log("Review #: ",n*o+d),console.log("Review Object: ",s),r.innerHTML+=`
                        <div class="row-item">
                            <input type="checkbox" name="selected-review-${s.review_id}" value="${s.review_id}" ${parseInt(s.is_selected)?"checked":""}>
                            <div class="row-item__cell" data-type="reviewer">${s.reviewer_display_name}</div>
                            <div class="row-item__cell" data-type="rating">${s.star_rating}</div>
                            <div class="row-item__cell" data-type="comment">${s.comment}</div>
                            <div class="row-item__cell" data-type="date">${new Date(s.create_time).toLocaleDateString()}</div>
                        </div>
                    `,a.appendChild(r))}if(!c)t.appendChild(a);else continue}updatePaginationControls(e.length,1,o),showPageReviews(1)}).catch(e=>{console.error("Error with promise: ",e)})});
