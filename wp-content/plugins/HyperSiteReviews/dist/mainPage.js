document.addEventListener("DOMContentLoaded",async()=>{const d=()=>new Promise(async(t,e)=>{const i=await fetch(window.HSRevApi.urls.selectedLocation,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":HSRevApi.nonce}});i.ok||e("Network response was not ok "+i.statusText);const n=await i.json();t(n)}),w=(t,e=1)=>new Promise(async(i,n)=>{let r=[],s=1;do{const a=await fetch(window.HSRevApi.urls.locationReviewsBase.replace("locations/%s",t)+"?"+new URLSearchParams({per_page:100,page:e}),{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":HSRevApi.nonce}});a.ok||n("Network response was not ok "+a.statusText);const c=await a.json();s=c.total_pages,c.reviews.forEach(o=>{r.push(o)}),e++}while(e<=s);i(r)}),l=document.getElementById("initial-reviews");window.HSRevApi&&d().then(t=>{const e=t.location_id;return w(e)}).then(t=>{const e=parseInt(reviewsPerPageSelect.selectedOptions[0].value);console.log(t),l.innerHTML="";const i=Math.ceil(t.length/e);for(let n=0;n<i;n++){const r=n===0,s=r?l:document.createElement("div"),a=document.createElement("div");a.classList.add("rows"),s.setAttribute("data-page",n+1),s.classList.add("reviews-page");for(let c=0;c<e;c++){const o=t[n*e+c];o&&(console.log("Review #: ",n*e+c),console.log("Review Object: ",o),a.innerHTML+=`
                        <div class="row-item">
                            <input type="checkbox" name="selected-review-${o.review_id}" value="${o.review_id}" ${parseInt(o.is_selected)?"checked":""}>
                            <div class="row-item__cell" data-type="reviewer">${o.reviewer_display_name}</div>
                            <div class="row-item__cell" data-type="rating">${o.star_rating}</div>
                            <div class="row-item__cell" data-type="comment">${o.comment}</div>
                            <div class="row-item__cell" data-type="date">${new Date(o.create_time).toLocaleDateString()}</div>
                        </div>
                    `,s.appendChild(a))}if(!r)reviewsTable.appendChild(s);else continue}updatePaginationControls(t.length,1,e),showPageReviews(1)}).catch(t=>{console.error("Error with promise: ",t)})});
