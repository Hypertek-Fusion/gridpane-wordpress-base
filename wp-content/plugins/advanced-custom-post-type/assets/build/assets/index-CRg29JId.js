import{j as e,u as s}from"./fields-Cqw4NA-S.js";import{a as v,R,L as z,u as J}from"./vendor-D21mNUGX.js";import{c as _,F as $,u as W,b as K}from"./index.esm-CunHohLK.js";import{n as b,a as S,s as E,f as Q,L as X}from"./Layout-DCNQQmUm.js";import{P as f,s as g,u as L,i as F,B as D,C as Z,D as q,E as ee,F as w,G as V,a as se,b as P,m as te,c as ae,L as le,H as T,J as re}from"./index-DxCcoVgy.js";import{M as Y}from"./index-Dp8I9ahT.js";import{I as M}from"./InputHidden-D-OSbUvk.js";import{L as O}from"./Label-DD1DoJkn.js";import{I}from"./Input-CuPRbCrx.js";import{d as ne,w as ie}from"./bundle.esm.min-B-HQpnrw.js";import{a as oe}from"./validation-D-MLcBjP.js";import{B as ce}from"./index-zHYFC1LM.js";import{P as de}from"./index-CEHVWT-1.js";import"./index-DRV1MUeg.js";import"./metaTypes-Bb9tjSPe.js";const A=({record:t,page:p,perPage:x,mode:j="save",style:l})=>{const o=L(),[n,c]=v.useState(!1),[d,u]=v.useState(!0),i=_({mode:"onChange"}),m=()=>e.jsxs("div",{className:"flex-between s-8",children:[e.jsx("span",{children:s("Dataset label")}),e.jsx("a",{href:"#",onClick:r=>{r.preventDefault(),u(!d)},children:s(`${d?"Auto slug ON":"Auto slug OFF"}`)})]}),y=r=>{o(Z(r)).then(N=>{const C=N.payload;C.success?(c(!n),b.success(s("Dataset successfully saved")),o(q({page:p||1,perPage:x}))):b.error(C.error)})};return e.jsxs(R.Fragment,{children:[e.jsx(Y,{size:"large",title:s(t?"Edit dataset":"Create a new dataset"),visible:n,buttons:[],children:e.jsx($,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(y),children:[e.jsx(M,{register:i.register,id:"emptyItems",value:0}),e.jsxs("div",{className:"flex-column s-24",children:[t&&e.jsx(R.Fragment,{children:e.jsx(M,{register:i.register,id:"id",value:t.id})}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"col-6",children:[e.jsx(O,{id:"label",label:m()}),e.jsx(I,{id:"label",register:i.register,placeholder:s("Dataset label"),defaultValue:j==="edit"&&!F(t)?t.label:"dataset name",errors:i.formState.errors,onChangeCapture:r=>{d&&i.setValue("name",ne(ie(r.target.value)))},onClick:r=>{(r.target.value==="dataset_name"||r.target.value==="dataset name")&&i.resetField("label")},validate:{maxLength:{value:255,message:"max length is 255"}}})]}),e.jsxs("div",{className:"col-6",children:[e.jsx(O,{id:"name",label:s("Dataset name")}),e.jsx(I,{id:"name",register:i.register,placeholder:s("Dataset name"),defaultValue:j==="edit"&&!F(t)?t.name:"dataset_name",errors:i.formState.errors,isRequired:!0,onClick:r=>{(r.target.value==="dataset_name"||r.target.value==="dataset name")&&i.resetField("name")},validate:{validate:oe,required:s("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})]})]}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(D,{testId:"save-form",style:g.PRIMARY,type:"submit",children:s("Save")}),e.jsx(D,{style:g.DANGER,type:"button",onClick:()=>{c(!n)},children:s("Close")})]})]})]})})}),j==="save"?e.jsx(D,{testId:"create-form",type:"button",onClick:()=>{c(!n)},style:l||g.PRIMARY,children:s("Create dataset")}):e.jsx("a",{href:"#",onClick:r=>{r.preventDefault(),c(!n)},children:s("Edit")})]})};A.propTypes={mode:f.oneOf(["edit","save"]).isRequired,style:f.oneOf(Object.values(g)),page:f.number,perPage:f.number,record:f.object};const B=({id:t,page:p,perPage:x})=>{const j=L(),[l,o]=v.useState(!1),n=()=>{j(ee(t)).then(d=>{const u=d.payload;u.success?(o(!l),S("Dataset successfully deleted."),w()):b.error(u.error)}).catch(d=>{b.error(d)})},c=[e.jsx(D,{style:g.DANGER,onClick:()=>{n()},children:s("Yes, delete it")}),e.jsx(D,{style:g.SECONDARY,onClick:()=>{o(!l)},children:s("Return back to list")})];return e.jsxs(R.Fragment,{children:[e.jsx(Y,{title:s("Delete dataset"),buttons:c,visible:l,children:e.jsx("div",{children:s("You are going to delete this dataset. Are you sure?")})}),e.jsx("a",{className:`color-${g.DANGER}`,href:"#",onClick:d=>{d.preventDefault(),o(!l)},children:s("Delete")})]})};B.propTypes={page:f.number,perPage:f.number,id:f.string.isRequired};const G=({record:t})=>{const{register:p}=W(),x=`elements.${t.id}`,j=()=>{V("duplicateAction",{belongsTo:"dataset",find:t.id}).then(l=>{l.success===!0?(S("Dataset successfully duplicated."),E(),w()):b.error(l.error)}).catch(l=>{console.error(l),b.error(s("Unknown error, please retry later"))})};return e.jsxs("tr",{children:[e.jsx("td",{style:{width:"24px"},children:e.jsxs("label",{"data-cy":`select-${t.name}`,className:"checkbox",htmlFor:x,children:[e.jsx("input",{type:"checkbox",id:x,name:x,defaultChecked:!1,...p(x)}),e.jsx("span",{})]})}),e.jsx("td",{children:t.name}),e.jsx("td",{children:t.label}),e.jsx("td",{children:t.items.length}),e.jsx("td",{children:e.jsxs("div",{"data-cy":`form-links-${t.name}`,className:"i-flex-center s-8",children:[e.jsx(A,{mode:"edit",record:t}),e.jsx(z,{to:`/tools/dataset/${t.id}`,children:s("Manage")}),e.jsx("a",{href:"#",onClick:l=>{l.preventDefault(),j()},children:s("Duplicate")}),e.jsx(B,{id:t.id})]})})]})};G.propTypes={record:f.object.isRequired};const Ae=()=>{const t=document.globals,p=t.settings,x=t.globals,[j,l]=v.useReducer(a=>a+1,0),o=v.useRef(),n=_({mode:"all"}),c=K({control:n.control,name:"elements"}),d=L(),{data:u,loading:i}=se(a=>a.fetchDatasets),{page:m}=J(),y=p.length>0&&P(p,"key","records_per_page")!==""?P(p,"key","records_per_page").value:20,r=Math.ceil(u.count/y);v.useEffect(()=>{E(),te(s("Dataset list")),ae("#/tools"),d(q({page:m||1,perPage:y})).then(a=>{Q()})},[m]),v.useEffect(()=>{(()=>{if(!c)return!1;let h=0;for(const[k,U]of Object.entries(c))U===!0&&h++;return h===Object.entries(c).length})()?o.current.checked=!0:o.current&&(o.current.checked=!1)},[c]),document.addEventListener("restoredElement",function(){l()});const N=a=>{n.reset(),a.belongsTo="dataset";const h=a.action;if(h)switch(h){case"hide":re(a);break;case"delete":case"duplicate":V("bulkActionsAction",a).then(k=>{if(k.success===!0){switch(h){case"delete":S("Dataset successfully deleted.");break;case"duplicate":S("Dataset successfully duplicated.");break}n.resetField("elements"),E(),w()}else b.error(k.error)}).catch(k=>{console.error(k),b.error(s("Unknown error, please retry later"))})}},C=a=>{u.records.filter(h=>!T(h.id,"dataset")).map(h=>{n.setValue(`elements.${h.id}`,a)})},H=[e.jsx(A,{page:m||1,perPage:y,mode:"save"})];return i?e.jsx(le,{}):e.jsx($,{...n,children:e.jsx("form",{onSubmit:n.handleSubmit(N),children:e.jsxs(X,{title:s("Dataset"),actions:H,crumbs:[{label:s("ACPT Tools"),link:"/tools"},{label:s("Dataset")}],children:[e.jsx(ce,{belongsTo:"dataset"}),u.records&&u.records.length>0?e.jsx("div",{className:"responsive with-shadow b-rounded",children:e.jsxs("table",{className:`acpt-table ${x.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"24px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"all",children:[e.jsx("input",{ref:o,type:"checkbox",id:"all",defaultChecked:!1,onClick:a=>C(a.currentTarget.checked)}),e.jsx("span",{})]})}),e.jsx("th",{children:s("Name")}),e.jsx("th",{children:s("Label")}),e.jsx("th",{children:s("Items count")}),e.jsx("th",{children:s("Actions")})]})}),e.jsx("tbody",{children:u.records&&u.records.map(a=>{if(!T(a.id,"dataset"))return e.jsx(G,{record:a},a.id)})}),r>1&&e.jsx("tfoot",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:e.jsx(de,{currentPage:m?parseInt(m):1,totalPages:r,baseLink:"/tools/dataset"})})})})]})}):e.jsx("div",{className:"p-24 bg-white with-shadow",children:e.jsxs("div",{className:"b-maxi b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:s("No dataset found.")}),e.jsx("div",{children:e.jsx(A,{style:g.SECONDARY,page:m||1,perPage:y,mode:"save"})})]})})]})})})};export{Ae as default};
