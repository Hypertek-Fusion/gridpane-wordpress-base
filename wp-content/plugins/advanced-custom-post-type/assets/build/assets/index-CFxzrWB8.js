import{j as e,u as s}from"./fields-Cqw4NA-S.js";import{a as u,R as O,L as N,u as G}from"./vendor-D21mNUGX.js";import{a as k,n as p,s as w,f as Y,L as q}from"./Layout-DCNQQmUm.js";import{P as b,u as D,B as C,s as g,Q as U,F,G as L,a as H,b as E,m as I,c as V,N as J,L as Q,H as S,J as W}from"./index-DxCcoVgy.js";import{S as y}from"./SaveFormModal-BrNCwxms.js";import{P as z}from"./index-CEHVWT-1.js";import{C as K}from"./index-DJ-BFKuq.js";import{M as X}from"./index-Dp8I9ahT.js";import{u as Z,c as ee,b as se,F as te}from"./index.esm-CunHohLK.js";import{r as re}from"./forms-CXGxWK8A.js";import{B as oe}from"./index-zHYFC1LM.js";import"./InputHidden-D-OSbUvk.js";import"./Label-DD1DoJkn.js";import"./Input-CuPRbCrx.js";import"./bundle.esm.min-B-HQpnrw.js";import"./validation-D-MLcBjP.js";import"./Select-DQFFBRh5.js";import"./index-C8n7JnXF.js";import"./objectWithoutPropertiesLoose-D8pFLZ8M.js";import"./index-Dc6Ibt6o.js";import"./metaTypes-Bb9tjSPe.js";import"./index-XHH1WL2a.js";import"./index-Cwt3Qm9G.js";import"./index-Dx-NZAGb.js";import"./posts-DE4oWSSH.js";import"./index-DRV1MUeg.js";const R=({id:r,page:m,perPage:i})=>{const j=D(),[o,a]=u.useState(!1),c=()=>{j(U(r)).then(d=>{const n=d.payload;n.success?(a(!o),k("Form successfully deleted."),F()):p.error(n.error)}).catch(d=>{p.error(d)})},h=[e.jsx(C,{style:g.DANGER,onClick:()=>{c()},children:s("Yes, delete it")}),e.jsx(C,{style:g.SECONDARY,onClick:()=>{a(!o)},children:s("Return back to list")})];return e.jsxs(O.Fragment,{children:[e.jsx(X,{title:s("Delete form"),buttons:h,visible:o,children:e.jsx("div",{children:s("You are going to delete this form. Are you sure?")})}),e.jsx("a",{className:`color-${g.DANGER}`,href:"#",onClick:d=>{d.preventDefault(),a(!o)},children:s("Delete")})]})};R.propTypes={page:b.number,perPage:b.number,id:b.string.isRequired};const P=u.memo(({record:r})=>{const{register:m}=Z(),i=`elements.${r.id}`,j=()=>{L("duplicateAction",{belongsTo:"form",find:r.id}).then(o=>{o.success===!0?(k("Form successfully duplicated."),w(),F()):p.error(o.error)}).catch(o=>{console.error(o),p.error(s("Unknown error, please retry later"))})};return e.jsxs("tr",{children:[e.jsx("td",{style:{width:"24px"},children:e.jsxs("label",{"data-cy":`select-${r.name}`,className:"checkbox",htmlFor:i,children:[e.jsx("input",{type:"checkbox",id:i,name:i,defaultChecked:!1,...m(i)}),e.jsx("span",{})]})}),e.jsx("td",{children:r.name}),e.jsx("td",{children:r.label}),e.jsx("td",{children:re(r.action)}),e.jsx("td",{children:e.jsx(K,{text:`[acpt_form id="${r.key}"]`})}),e.jsx("td",{children:e.jsxs("div",{"data-cy":`form-links-${r.name}`,className:"i-flex-center s-8",children:[e.jsx(y,{mode:"edit",record:r}),e.jsx(N,{to:`/form/${r.id}`,children:s("Manage")}),e.jsx("a",{href:"#",onClick:o=>{o.preventDefault(),j()},children:s("Duplicate")}),e.jsx(R,{id:r.id}),e.jsx(N,{to:`/form-submissions/${r.id}`,className:"color-warning",children:s("Submissions")})]})})]})});P.propTypes={record:b.object.isRequired};const le=()=>{const r=document.globals,m=r.settings,i=r.globals,[j,o]=u.useReducer(t=>t+1,0),a=u.useRef(),c=ee({mode:"all"}),h=se({control:c.control,name:"elements"}),d=D(),{data:n,loading:T}=H(t=>t.fetchForms),{page:f}=G(),v=m.length>0&&E(m,"key","records_per_page")!==""?E(m,"key","records_per_page").value:20,A=Math.ceil(n.count/v);u.useEffect(()=>{I(s("Forms list")),V("#/forms"),d(J({page:f||1,perPage:v})).then(t=>{Y()})},[f]),u.useEffect(()=>{(()=>{if(!h)return!1;let l=0;for(const[x,B]of Object.entries(h))B===!0&&l++;return l===Object.entries(h).length})()?a.current.checked=!0:a.current&&(a.current.checked=!1)},[h]),document.addEventListener("restoredElement",function(){o()});const M=t=>{c.reset(),t.belongsTo="form";const l=t.action;if(l)switch(l){case"hide":W(t);break;case"delete":case"duplicate":L("bulkActionsAction",t).then(x=>{if(x.success===!0){switch(l){case"delete":k("Form successfully deleted.");break;case"duplicate":k("Form successfully duplicated.");break}c.resetField("elements"),w(),F()}else p.error(x.error)}).catch(x=>{console.error(x),p.error(s("Unknown error, please retry later"))})}},$=t=>{n.records.filter(l=>!S(l.id,"form")).map(l=>{c.setValue(`elements.${l.id}`,t)})},_=[e.jsx(y,{mode:"save"})];return T?e.jsx(Q,{}):e.jsx(te,{...c,children:e.jsx("form",{onSubmit:c.handleSubmit(M),children:e.jsxs(q,{actions:_,title:s("Forms list"),crumbs:[{label:s("Forms list")}],children:[e.jsx(oe,{belongsTo:"form"}),n.records&&n.records.length>0?e.jsx("div",{className:"responsive with-shadow b-rounded",children:e.jsxs("table",{className:`acpt-table ${i.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"24px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"all",children:[e.jsx("input",{ref:a,type:"checkbox",id:"all",defaultChecked:!1,onClick:t=>{n.records.map(l=>$(t.currentTarget.checked))}}),e.jsx("span",{})]})}),e.jsx("th",{children:s("Name")}),e.jsx("th",{children:s("Label")}),e.jsx("th",{children:s("Action")}),e.jsx("th",{children:s("Shortcode")}),e.jsx("th",{children:s("Actions")})]})}),e.jsx("tbody",{children:n.records&&n.records.map(t=>{if(!S(t.id,"form"))return e.jsx(P,{record:t},t.id)})}),A>1&&e.jsx("tfoot",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx(z,{currentPage:f?parseInt(f):1,totalPages:A,baseLink:"/forms"})})})})]})}):e.jsx("div",{className:"p-24 bg-white with-shadow",children:e.jsxs("div",{className:"b-maxi b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:s("No forms found.")}),e.jsx("div",{children:e.jsx(y,{style:g.SECONDARY,mode:"save"})})]})})]})})})};le.propTypes={};export{le as default};
