import{j as e,u as s}from"./fields-Cqw4NA-S.js";import{h as q,a as h,R as P,L as j,u as B}from"./vendor-D21mNUGX.js";import{a as T,n as p,s as C,f as G,L as U}from"./Layout-DCNQQmUm.js";import{P as x,u as w,B as R,s as y,c7 as I,F as N,br as V,G as Y,ah as H,a as J,b as M,m as W,c as z,h as K,L as Q,H as E,A as Z,J as ee}from"./index-DxCcoVgy.js";import{B as se}from"./index-Cbo4wqr7.js";import{T as v}from"./index-XHH1WL2a.js";import{P as te}from"./index-CEHVWT-1.js";import{F as oe,E as ae}from"./FieldGroupsModal-WonEmKbD.js";import{m as c}from"./metaTypes-Bb9tjSPe.js";import{E as re}from"./index-B85TJfsV.js";import{M as ne}from"./index-Dp8I9ahT.js";import{u as D,c as le,b as ie,F as ce}from"./index.esm-CunHohLK.js";import{u as de}from"./index-DRV1MUeg.js";import{B as me}from"./index-zHYFC1LM.js";import"./index-Cwt3Qm9G.js";import"./index-WYQ2JGQs.js";import"./index-DUqbm7sl.js";import"./index-C8n7JnXF.js";import"./objectWithoutPropertiesLoose-D8pFLZ8M.js";import"./index-Dc6Ibt6o.js";const L=({taxonomy:t,page:u,perPage:b})=>{const{reset:f}=D(),n=w();q();const[r,a]=h.useState(!1),k=()=>{n(I(t)).then(m=>{const i=m.payload;i.success?(f(),a(!r),T("Taxonomy successfully deleted."),N()):p.error(i.error)}).catch(m=>{p.error(m)})},d=[e.jsx(R,{style:y.DANGER,onClick:()=>{k()},children:s("Yes, delete it")}),e.jsx(R,{style:y.SECONDARY,onClick:()=>{a(!r)},children:s("Return back to list")})];return e.jsxs(P.Fragment,{children:[e.jsx(ne,{title:s("Delete Taxonomy"),buttons:d,visible:r,children:e.jsx("div",{children:s("You are going to delete this taxonomy. Are you sure?")})}),e.jsx("a",{className:`color-${y.DANGER}`,href:"#",onClick:m=>{m.preventDefault(),a(!r)},children:s("Delete")})]})};L.propTypes={page:x.number.isRequired,perPage:x.number.isRequired,taxonomy:x.string.isRequired};const $=h.memo(({record:t,page:u,perPage:b})=>{const{register:f}=D(),n=`elements.${t.slug}`,r=()=>{Y("duplicateAction",{belongsTo:c.TAXONOMY,find:t.slug}).then(a=>{a.success===!0?(T("Taxonomy successfully duplicated."),C(),N()):p.error(a.error)}).catch(a=>{console.error(a),p.error(s("Unknown error, please retry later"))})};return e.jsx(P.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{style:{width:"24px"},children:!t.isNative&&e.jsxs("label",{className:"checkbox",htmlFor:n,"data-cy":`select-${t.slug}`,children:[e.jsx("input",{type:"checkbox",id:n,name:n,defaultChecked:!1,...f(n)}),e.jsx("span",{})]})}),e.jsx("td",{children:t.slug}),e.jsx("td",{children:e.jsx(re,{element:t})}),e.jsx("td",{children:V(t,"customPostTypes")&&t.customPostTypes.length>0?e.jsx(j,{to:`/assoc-post-taxonomy/${t.slug}`,children:s("Manage")}):e.jsx(j,{to:`/assoc-post-taxonomy/${t.slug}`,children:s("Associate")})}),e.jsx("td",{children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(j,{to:`/register_meta?belongsTo=${c.TAXONOMY}&find=${t.slug}`,children:s("Create")}),e.jsx(oe,{find:t.slug,belongsTo:c.TAXONOMY})]})}),e.jsx("td",{children:!t.isNative&&e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("a",{href:`#/view_taxonomy/${t.slug}`,children:s("View")}),e.jsx("a",{href:`#/edit_taxonomy/${t.slug}`,children:s("Edit")}),e.jsx("a",{href:"#",onClick:a=>{a.preventDefault(),r()},children:s("Duplicate")}),e.jsx(L,{page:u,perPage:b,taxonomy:t.slug}),e.jsx(ae,{belongsTo:c.TAXONOMY,find:t.slug}),e.jsx(j,{to:`/permissions/taxonomy/${t.slug}/${t.id}`,className:"color-warning",children:s("Permissions")})]})})]})})});$.propTypes={page:x.number.isRequired,perPage:x.number.isRequired,record:x.object.isRequired};const ue=()=>{const t=document.globals,u=t.settings;H(c.TAXONOMY);const[b,f]=h.useReducer(o=>o+1,0);de();const n=h.useRef(),r=le({mode:"all"}),a=ie({control:r.control,name:"elements"}),k=w(),{data:d,loading:m}=J(o=>o.fetchTaxonomies),{page:i}=B(),A=u.length>0&&M(u,"key","records_per_page")!==""?M(u,"key","records_per_page").value:20,O=Math.ceil(d.count/A);h.useEffect(()=>{W(s("Registered Taxonomies")),z("#/taxonomies"),k(K({page:i||1,perPage:A})).then(o=>{G()})},[i]),h.useEffect(()=>{(()=>{if(!a)return!1;let l=0;for(const[g,X]of Object.entries(a))X===!0&&l++;return l===Object.entries(a).length})()?n.current.checked=!0:n.current&&(n.current.checked=!1)},[a]),document.addEventListener("restoredElement",function(){f()});const F=o=>{r.reset(),o.belongsTo=c.TAXONOMY;const l=o.action;if(l)switch(l){case"hide":ee(o);break;case"delete":case"duplicate":Y("bulkActionsAction",o).then(g=>{if(g.success===!0){switch(o.action){case"delete":T("Taxonomy successfully deleted.");break;case"duplicate":T("Taxonomy successfully duplicated.");break}C(),N()}else p.error(g.error)}).catch(g=>{console.error(g),p.error(s("Unknown error, please retry later"))});break}},S=o=>{d.records.filter(l=>l.isNative===!1).filter(l=>!E(l.slug,c.TAXONOMY)).map(l=>{r.setValue(`elements.${l.slug}`,o)})},_=[e.jsx(se,{style:y.PRIMARY,to:"/register_taxonomy",children:s("Register new Taxonomy")})];return m?e.jsx(Q,{}):e.jsx(ce,{...r,children:e.jsx("form",{onSubmit:r.handleSubmit(F),children:e.jsxs(U,{title:s("Registered Taxonomies"),actions:_,crumbs:[{label:s("Registered Taxonomies")}],children:[e.jsx(me,{belongsTo:c.TAXONOMY}),d.records&&d.records.length>0?e.jsx("div",{className:"responsive with-shadow b-rounded",children:e.jsxs("table",{"data-cy":"cpt-table",className:`acpt-table ${t.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"24px"},children:e.jsxs("label",{"data-cy":"select-all",className:"checkbox",htmlFor:"all",children:[e.jsx("input",{ref:n,type:"checkbox",id:"all",defaultChecked:!1,onClick:o=>S(o.currentTarget.checked)}),e.jsx("span",{})]})}),e.jsx("th",{children:e.jsx(v,{tip:s("Taxonomy slug. The post name/slug. Used for various queries for taxonomy content."),label:s("Slug")})}),e.jsx("th",{children:s("Type")}),e.jsx("th",{children:e.jsx(v,{tip:s("Associate custom post types here"),label:s("Associated post types")})}),e.jsx("th",{children:s("Field groups")}),e.jsx("th",{children:s("Actions")})]})}),e.jsx("tbody",{children:d.records&&d.records.map(o=>{if(!E(o.slug,c.TAXONOMY))return e.jsx($,{record:o,page:i,perPage:A},o.id)})}),O>1&&e.jsx("tfoot",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx(te,{currentPage:i?parseInt(i):1,totalPages:O,baseLink:"/taxonomies"})})})})]})}):e.jsxs(Z,{style:y.SECONDARY,children:[s("No taxonomies found.")," ",e.jsx(j,{to:"/register_taxonomy",children:s("Register the first one")}),"!"]})]})})})};ue.propTypes={};export{ue as default};
