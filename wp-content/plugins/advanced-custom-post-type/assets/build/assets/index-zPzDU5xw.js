import{j as e,u as s}from"./fields-Cqw4NA-S.js";import{a as u,R as A,L as j,u as V}from"./vendor-D21mNUGX.js";import{a as N,n as C,s as Y,f as H,L as J}from"./Layout-DCNQQmUm.js";import{P,b as w,u as L,B as R,s as p,A as M,bq as z,F as _,br as D,G as O,a as K,m as Q,j as X,L as Z,H as $,J as ee}from"./index-DxCcoVgy.js";import{T as F}from"./index-XHH1WL2a.js";import{E as se}from"./index-CTAGjDz_.js";import{E as te}from"./index-B85TJfsV.js";import{F as oe,E as le}from"./FieldGroupsModal-WonEmKbD.js";import{m as g}from"./metaTypes-Bb9tjSPe.js";import{M as U}from"./index-Dp8I9ahT.js";import{u as q,c as ne,b as ae,F as re}from"./index.esm-CunHohLK.js";import{P as ce}from"./index-CEHVWT-1.js";import{B as ie}from"./index-Cbo4wqr7.js";import{u as de}from"./index-DRV1MUeg.js";import{B as me}from"./index-zHYFC1LM.js";import"./index-Cwt3Qm9G.js";import"./index-WYQ2JGQs.js";import"./index-DUqbm7sl.js";import"./index-C8n7JnXF.js";import"./objectWithoutPropertiesLoose-D8pFLZ8M.js";import"./index-Dc6Ibt6o.js";const G=({postType:t,page:y,perPage:d})=>{const x=document.globals.settings,c=w(x,"key","delete_posts").value,{reset:i}=q(),n=L(),[f,a]=u.useState(!1),k=()=>{n(z(t,"all")).then(m=>{const o=m.payload;o.success?(i(),a(!f),N("Custom post type successfully deleted."),_()):C.error(o.error)}).catch(m=>{C.error(m)})},h=[e.jsx(R,{style:p.DANGER,onClick:()=>{k()},children:s("Yes, delete it")}),e.jsx(R,{style:p.SECONDARY,onClick:()=>{a(!f)},children:s("Return back to list")})];return e.jsxs(A.Fragment,{children:[e.jsxs(U,{title:s("Delete custom post type"),buttons:h,visible:f,children:[e.jsx("div",{children:s("You are going to delete this custom post type. Are you sure?")}),c&&e.jsx("div",{className:"mt-24",children:e.jsx(M,{style:p.WARNING,children:s("WARNING: This action will delete all posts and metadata for this post type. The action is irreversible.")})})]}),e.jsx("a",{href:"#",className:`color-${p.DANGER}`,onClick:m=>{m.preventDefault(),a(!f)},children:s("Delete")})]})};G.propTypes={page:P.number.isRequired,perPage:P.number.isRequired,postType:P.string.isRequired};const W=u.memo(({record:t,showWooCommerceColumn:y,page:d,perPage:b})=>{const{register:x}=q(),c=`elements.${t.name}`,i=()=>{O("duplicateAction",{belongsTo:g.CUSTOM_POST_TYPE,find:t.name}).then(n=>{n.success===!0?(N("Custom post type successfully duplicated."),Y(),_()):C.error(n.error)}).catch(n=>{console.error(n),C.error(s("Unknown error, please retry later"))})};return e.jsx(A.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{style:{width:"24px"},children:!t.isNative&&e.jsxs("label",{className:"checkbox",htmlFor:c,"data-cy":`select-${t.name}`,children:[e.jsx("input",{type:"checkbox",id:c,name:c,defaultChecked:!1,...x(c)}),e.jsx("span",{})]})}),e.jsx("td",{children:e.jsx(se,{value:t.icon})}),e.jsx("td",{children:t.name}),e.jsx("td",{children:e.jsx(te,{element:t})}),e.jsx("td",{children:D(t,"taxonomies")&&t.taxonomies.length>0?e.jsx(j,{to:`/assoc-taxonomy-post/${t.name}`,children:s("Manage")}):e.jsx(j,{to:`/assoc-taxonomy-post/${t.name}`,children:s("Associate")})}),y&&e.jsx("td",{children:t.isWooCommerce===!0&&e.jsx(A.Fragment,{children:D(t,"woocommerceProductData")&&t.woocommerceProductData.length>0?e.jsx(j,{to:`/product-data/${t.name}`,children:s("Manage")}):e.jsx(j,{to:`/product-data/${t.name}`,children:s("Create")})})}),e.jsx("td",{children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(j,{to:`/register_meta?belongsTo=${g.CUSTOM_POST_TYPE}&find=${t.name}`,children:s("Create")}),e.jsx(oe,{find:t.name,belongsTo:g.CUSTOM_POST_TYPE})]})}),e.jsx("td",{children:!t.isNative&&e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(j,{to:`view/${t.name}`,children:s("View")}),e.jsx(j,{to:`edit/${t.name}`,children:s("Edit")}),e.jsx("a",{href:"#",onClick:n=>{n.preventDefault(),i()},children:s("Duplicate")}),e.jsx(G,{page:d,perPage:b,postType:t.name}),e.jsx(le,{belongsTo:g.CUSTOM_POST_TYPE,find:t.name}),e.jsx(j,{to:`/permissions/post/${t.name}/${t.id}`,className:"color-warning",children:s("Permissions")})]})})]})})});W.propTypes={page:P.number.isRequired,perPage:P.number.isRequired,record:P.object.isRequired,showWooCommerceColumn:P.bool.isRequired};const ue=()=>{const y=document.globals.globals,[d,b]=u.useState(!1),[x,c]=u.useState([]),[i,n]=u.useState(!1),[f,a]=u.useState([]);u.useEffect(()=>{d===!0&&(n(!0),O("fetchPostTypesAction",{}).then(o=>{c(o),n(!1)}).catch(o=>{console.error(o.message),n(!1)}))},[d]);const k=()=>{O("syncPostsAction",{postTypes:f}).then(o=>{o.success&&(N("Successfully post sync."),_()),o.error&&C.error(error),b(!d)}).catch(o=>{console.error(o.message)})},h=(o,S)=>{a(S===!0?T=>[...T,o]:T=>T.filter(v=>v!==o))},m=[e.jsx(R,{style:p.PRIMARY,disabled:f.length===0,onClick:()=>{k()},children:s("Sync")}),e.jsx(R,{style:p.SECONDARY,onClick:()=>{b(!d)},children:s("Return back to list")})];return e.jsxs(A.Fragment,{children:[e.jsx(U,{title:s("Sync with post types"),buttons:m,visible:d,children:i?e.jsx("div",{children:"Loading..."}):e.jsx(A.Fragment,{children:x&&x.length>0?e.jsx("div",{className:"responsive",children:e.jsx("table",{className:`acpt-table spaceless ${y.is_rtl?"rtl":""}`,children:e.jsx("tbody",{children:x.map(o=>e.jsx("tr",{children:e.jsx("td",{children:e.jsxs("label",{className:"checkbox",htmlFor:`select_${o.name}`,children:[e.jsx("input",{name:`select_${o.name}`,defaultChecked:!1,type:"checkbox",id:`select_${o.name}`,onChange:S=>h(o.name,S.target.checked)}),e.jsx("span",{children:o.label})]})})}))})})}):e.jsx(M,{style:p.SECONDARY,children:s("No custom post type found.")})})}),e.jsx(R,{type:"button",style:p.SECONDARY,onClick:o=>{o.preventDefault(),b(!d)},children:s("Sync with post types")})]})},Me=()=>{const t=document.globals,y=t.settings,d=t.globals,[b,x]=u.useReducer(l=>l+1,0);de();const c=u.useRef(),i=ne({mode:"all"}),n=ae({control:i.control,name:"elements"}),f=L(),{data:a,loading:k}=K(l=>l.fetchCustomPostTypes),{page:h}=V(),m=y.length>0&&w(y,"key","records_per_page")!==""?w(y,"key","records_per_page").value:20,o=Math.ceil(a.count/m);u.useEffect(()=>{Q(s("Registered Custom Post Types")),f(X({page:h||1,perPage:m})).then(l=>{H()})},[h]),u.useEffect(()=>{(()=>{if(!n)return!1;let r=0;for(const[E,I]of Object.entries(n))I===!0&&r++;return r===Object.entries(n).length})()?c.current.checked=!0:c.current&&(c.current.checked=!1)},[n]),document.addEventListener("restoredElement",function(){x()});const S=l=>{i.reset(),l.belongsTo=g.CUSTOM_POST_TYPE;const r=l.action;if(r){switch(r){case"hide":ee(l);break;case"delete":case"duplicate":O("bulkActionsAction",l).then(E=>{if(E.success===!0){switch(r){case"delete":N("Custom post type successfully deleted.");break;case"duplicate":N("Custom post type successfully duplicated.");break}Y(),_()}else C.error(E.error)}).catch(E=>{console.error(E),C.error(s("Unknown error, please retry later"))});break}i.resetField("elements")}},T=()=>{if(!a.records)return!1;let l=0;return a.records.map(r=>{r.isWooCommerce===!0&&l++}),l>0},v=l=>{a.records.filter(r=>r.isNative===!1).filter(r=>!$(r.name,g.CUSTOM_POST_TYPE)).map(r=>{i.setValue(`elements.${r.name}`,l)})},B=[e.jsx(ie,{style:p.PRIMARY,to:"/register",children:s("Register new Post Type")}),e.jsx(ue,{})];return k?e.jsx(Z,{}):e.jsx(re,{...i,children:e.jsx("form",{onSubmit:i.handleSubmit(S),children:e.jsxs(J,{title:s("Registered Custom Post Types"),actions:B,crumbs:[{label:s("Registered Custom Post Types")}],children:[e.jsx(me,{belongsTo:g.CUSTOM_POST_TYPE}),a.records&&a.records.length>0?e.jsx("div",{className:"responsive with-shadow b-rounded",children:e.jsxs("table",{"data-cy":"cpt-table",className:`acpt-table ${d.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"24px"},children:e.jsxs("label",{"data-cy":"select-all",className:"checkbox",htmlFor:"all",children:[e.jsx("input",{ref:c,type:"checkbox",id:"all",defaultChecked:!1,onClick:l=>v(l.currentTarget.checked)}),e.jsx("span",{})]})}),e.jsx("th",{}),e.jsx("th",{children:s("Name")}),e.jsx("th",{children:s("Type")}),e.jsx("th",{children:e.jsx(F,{tip:s("Associated taxonomies with the post"),label:s("Associated taxonomies")})}),T()&&e.jsx("th",{children:e.jsx(F,{tip:s("Associated WooCommerce product data"),label:s("Product data")})}),e.jsx("th",{children:s("Field groups")}),e.jsx("th",{children:s("Actions")})]})}),e.jsx("tbody",{children:a.records&&a.records.map(l=>{if(!$(l.name,g.CUSTOM_POST_TYPE))return e.jsx(W,{record:l,page:h,perPage:m,showWooCommerceColumn:T()},l.id)})}),o>1&&e.jsx("tfoot",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:T()?8:7,children:e.jsx(ce,{currentPage:h?parseInt(h):1,totalPages:o,baseLink:""})})})})]})}):e.jsxs(M,{style:p.SECONDARY,children:[s("No custom post types found.")," ",e.jsx(j,{to:"/register",children:s("Register the first one")}),"!"]})]})})})};export{Me as default};
