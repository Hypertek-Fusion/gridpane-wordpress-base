import{j as e,u as a,f as U}from"./fields-Cqw4NA-S.js";import{a as _,R as F}from"./vendor-D21mNUGX.js";import{P as p,ab as ie,ac as Y,G as oe,A as ne,s as I,u as re,i as w,B as q,ad as ce,F as me}from"./index-DxCcoVgy.js";import{M as de}from"./index-Dp8I9ahT.js";import{u as O,b as B,c as ue,F as fe}from"./index.esm-CunHohLK.js";import{I as D}from"./InputHidden-D-OSbUvk.js";import{L as g}from"./Label-DD1DoJkn.js";import{I as C}from"./Input-CuPRbCrx.js";import{d as he,w as pe}from"./bundle.esm.min-B-HQpnrw.js";import{a as xe}from"./validation-D-MLcBjP.js";import{S as L}from"./Select-DQFFBRh5.js";import{g as h,f as A,a as je}from"./forms-CXGxWK8A.js";import{R as X}from"./index-C8n7JnXF.js";import{l as z}from"./index-Dc6Ibt6o.js";import{m as x}from"./metaTypes-Bb9tjSPe.js";import{T as H}from"./index-XHH1WL2a.js";import{M as _e}from"./index-Dx-NZAGb.js";import{p as ge}from"./posts-DE4oWSSH.js";import{a as be,n as ve}from"./Layout-DCNQQmUm.js";const W=({record:t})=>{const{register:l,setValue:i,formState:{errors:o}}=O(),c=`
// data contains the Promise response
console.log(data);
    `;return _.useEffect(()=>{(!t||t&&!t.ajax_action)&&i("meta.0.ajax_handling",c)},[]),e.jsxs(F.Fragment,{children:[e.jsxs("div",{children:[e.jsx(g,{id:"meta.0.ajax_action",label:a("Ajax action")}),e.jsx(C,{id:"meta.0.ajax_action",errors:o,register:l,defaultValue:h(t,"ajax_action"),validate:{required:a("This field is mandatory")}})]}),e.jsxs("div",{children:[e.jsx(g,{id:"meta.0.ajax_handling",label:a("Ajax success response handling")}),e.jsx("div",{className:"with-border b-rounded",children:e.jsx(X,{value:h(t,"ajax_handling",c),height:"250px",editable:!0,theme:"light",extensions:[z.jsx({})],onChange:n=>{i("meta.0.ajax_handling",n)}})})]})]})};W.propTypes={record:p.object};const J=({record:t})=>{const{register:l,formState:{errors:i}}=O(),o=[{label:a("Select"),value:null},{label:"POST",value:"POST"},{label:"GET",value:"GET"}];return e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"col-6",children:[e.jsx(g,{id:"meta.0.custom_action",label:a("Custom action")}),e.jsx(C,{id:"meta.0.custom_action",errors:i,register:l,defaultValue:h(t,"custom_action"),validate:{required:a("This field is mandatory")}})]}),e.jsxs("div",{className:"col-6",children:[e.jsx(g,{id:"meta.1.custom_method",label:a("Method")}),e.jsx(L,{id:"meta.1.custom_method",errors:i,register:l,values:o,defaultValue:h(t,"custom_method"),validate:{required:a("This field is mandatory")}})]})]})};J.propTypes={record:p.object};const K=({record:t})=>{const{setValue:l}=O(),i=`<?php
// $_POST and $_FILES store form data already sanitized
// by HandleFormSubmissionCommand class
$data = $_POST;
$files = $_FILES;`;return _.useEffect(()=>{(!t||t&&!t.php_action)&&l("meta.0.php_action",i)},[]),e.jsxs("div",{children:[e.jsx(g,{id:"meta.0.php_action",label:a("PHP custom handling")}),e.jsx("div",{className:"with-border b-rounded",children:e.jsx(X,{value:h(t,"php_action",i),height:"250px",editable:!0,theme:"light",extensions:[z.php({})],onChange:o=>{l("meta.0.php_action",o)}})})]})};K.propTypes={record:p.object};const Te=()=>e.jsx("div",{children:"EmailAction"}),Q=({index:t,defaultChecked:l=!0,metaField:i,handleChecked:o=null})=>{const{register:c}=O(),n=`meta.3.fill_meta_fields.${t}`;return e.jsx(F.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("label",{className:"checkbox",htmlFor:`${n}`,children:[e.jsx("input",{name:n,value:i.id,defaultChecked:l,type:"checkbox",id:n,...c(`${n}`),onClick:b=>{o&&o(b.target.checked)}}),e.jsx("span",{})]})}),e.jsx("td",{style:{width:"33%"},children:i.groupName}),e.jsx("td",{style:{width:"33%"},children:i.name}),e.jsx("td",{style:{width:"33%"},children:e.jsx(_e,{fieldType:i.type,css:"top-2"})})]})})};Q.propTypes={index:p.number.isRequired,defaultChecked:p.bool,handleChecked:p.func,metaField:p.object.isRequired};const Z=({defaultValue:t,metaFields:l})=>{const i=_.useRef(null),{setValue:o,getValues:c}=O();_.useEffect(()=>{c("meta.3.fill_meta_fields")&&!c("meta.3.fill_meta_fields").includes(!1)&&(i.current.checked=!0)},[c]);const n=()=>c("meta.3.fill_meta_fields")?!c("meta.3.fill_meta_fields").includes(!1):!1,b=u=>{u===!1&&(i.current.checked=!1),ie(1).then(()=>{n()&&(i.current.checked=!0)})},v=u=>{const s=[];l.length>0&&l.filter(T=>T.type!==U.CLONE).map(T=>{u?s.push(T.id):s.push(!1)}),o("meta.3.fill_meta_fields",s)};return e.jsx("div",{style:{maxHeight:250,overflowY:"auto"},children:e.jsxs("table",{className:"acpt-table with-border b-rounded",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsxs("label",{className:"checkbox",htmlFor:"select_all",children:[e.jsx("input",{ref:i,type:"checkbox",id:"select_all",defaultChecked:n(),onClick:u=>{v(u.target.checked)}}),e.jsx("span",{})]})}),e.jsx("th",{children:a("Group")}),e.jsx("th",{children:a("Field")}),e.jsx("th",{children:a("Type")})]})}),e.jsx("tbody",{children:l.length>0&&l.filter(u=>u.type!==U.CLONE).map((u,s)=>e.jsx(Q,{index:s,defaultChecked:t?t[s]===u.id:!0,metaField:u,handleChecked:b},u.id))})]})})};Z.propTypes={defaultValue:p.array,metaFields:p.array.isRequired};const ee=({record:t,action:l})=>{const o=document.globals.globals,[c,n]=_.useState(null),[b,v]=_.useState([]),[u,s]=_.useState(null),[T,y]=_.useState([]);_.useEffect(()=>{if(t&&t.meta.length>0){const r=h(t,"fill_meta_location_belong"),j=h(t,"fill_meta_location_find");if(r&&j){let m;r===x.CUSTOM_POST_TYPE&&(m="Post"),r===x.TAXONOMY&&(m="Taxonomy"),$(j,m)}}},[]);const{control:V,register:N,formState:{errors:E},setValue:f,resetField:M,getValues:R}=O(),G=B({control:V,name:"meta.0.fill_meta_location_belong"}),te=()=>{let r=[{label:a("Select"),value:null}];const j=o.find[x.CUSTOM_POST_TYPE].filter(P=>P.value!==null),m=o.find[x.TAXONOMY].filter(P=>P.value!==null),d=o.find[x.OPTION_PAGE].filter(P=>P.value!==null),S=[{label:a("All users"),value:x.USER}];return j.length>0&&r.push({label:a("Post"),options:j}),m.length>0&&r.push({label:a("Taxonomy"),options:m}),d.length>0&&r.push({label:a("Option pages"),options:d}),r.push({label:a("Users"),options:S}),r},$=(r,j)=>{let m;if(M("meta.0.fill_meta_location_belong"),n(null),s(null),v([]),r===x.USER){const d=[...o.find.USER_ID];d.splice(1,0,{label:a("Create new user"),value:"0"}),m=x.USER,n("User"),s("If blank, the current logged user ID will be used"),v(d)}if(j==="Post"){m=x.CUSTOM_POST_TYPE,n("Post"),s("If blank, the current post_ID will be used");const d=o.find.POST_ID.filter(S=>S.label===r);d.length===1&&Y(d[0].options)&&v([{label:a("Create new post"),value:"0"},...d[0].options])}if(j==="Taxonomy"){m=x.TAXONOMY,n(a("Taxonomy")),s("If blank, the current queried term_ID will be used");const d=o.find.TERM_ID.filter(S=>S.label===r);d.length===1&&Y(d[0].options)&&v([{label:a("Create new term"),value:"0"},...d[0].options])}j==="Option pages"&&(m=x.OPTION_PAGE),ae(r,m),f("meta.0.fill_meta_location_belong",m),M("meta.1.fill_meta_location_item")},ae=(r,j)=>{oe("fetchMetaAction",{find:r,belongsTo:j,formBuilder:!0,clonedFields:!0}).then(m=>{let d=[];m.records.map(S=>{S.boxes.map(P=>{P.fields.map(k=>{k.groupName=S.name,k.boxName=P.name,d.push(k)})})}),y(d)}).catch(m=>console.error(m))},se=()=>G||h(t,"fill_meta_location_belong"),le=()=>l!==A.FILL_META?{}:{required:a("This field is mandatory")};return e.jsxs(F.Fragment,{children:[e.jsxs("div",{className:"container",children:[e.jsx(D,{register:N,id:"meta.0.fill_meta_location_belong",value:h(t,"fill_meta_location_belong")}),e.jsxs("div",{className:`col-${se()===x.OPTION_PAGE?12:c==="Post"?4:6}`,children:[e.jsx(g,{id:"meta.1.fill_meta_location_find",label:a("List to populate from")}),e.jsx(L,{id:"meta.1.fill_meta_location_find",errors:E,register:N,values:te(),defaultValue:h(t,"fill_meta_location_find"),onChangeCapture:r=>{$(r.target.value,r.target.selectedOptions[0].parentElement.dataset.original)},validate:le()})]}),c&&e.jsxs(F.Fragment,{children:[e.jsxs("div",{className:c==="Post"?"col-4":"col-6",children:[e.jsx(H,{label:e.jsx("label",{className:"form-label",htmlFor:"meta.2.fill_meta_location_item",children:a(c)}),tip:a(u)}),e.jsx("div",{className:"mt-4",children:e.jsx(L,{id:"meta.2.fill_meta_location_item",errors:E,register:N,values:b,defaultValue:h(t,"fill_meta_location_item","0")})})]}),c==="Post"&&e.jsx(F.Fragment,{children:e.jsxs("div",{className:"col-4",children:[e.jsx(H,{label:e.jsx("label",{className:"form-label",htmlFor:"meta.3.fill_meta_location_status",children:a("Post status")}),tip:a("The updated or new post status")}),e.jsx("div",{className:"mt-4",children:e.jsx(L,{id:"meta.3.fill_meta_location_status",errors:E,register:N,values:ge,defaultValue:h(t,"fill_meta_location_status","publish")})})]})})]})]}),T&&T.length>0?e.jsx(Z,{defaultValue:h(t,"fill_meta_fields"),metaFields:T}):e.jsx(ne,{style:I.WARNING,children:a("No fields registered.")})]})};ee.propTypes={record:p.object,action:p.string};const ye=({record:t,mode:l="save",classButton:i,style:o})=>{const c=re(),[n,b]=_.useState(!1),[v,u]=_.useState(!0),s=ue({mode:"onChange"}),T=B({control:s.control,name:"action"}),y=()=>T||(t?t.action:null),V=()=>e.jsxs("div",{className:"flex-between s-8",children:[e.jsx("span",{children:a("Form label")}),e.jsx("a",{href:"#",onClick:f=>{f.preventDefault(),u(!v)},children:a(`${v?"Auto slug ON":"Auto slug OFF"}`)})]}),N=f=>{c(ce(f)).then(M=>{const R=M.payload;R.success?(b(!n),be(a("Form successfully saved")),me()):ve.error(R.error)})},E=()=>s.getValues("action")?typeof s.getValues("action")<"u":t?t.action!=="":!1;return e.jsxs(F.Fragment,{children:[e.jsx(de,{size:"large",title:a(t?"Edit form":"Create a new form"),visible:n,buttons:[],children:e.jsx(fe,{...s,children:e.jsx("form",{onSubmit:s.handleSubmit(N),children:e.jsxs("div",{className:"flex-column s-24",children:[t&&e.jsxs(F.Fragment,{children:[e.jsx(D,{register:s.register,id:"id",value:t.id}),e.jsx(D,{register:s.register,id:"key",value:t.key})]}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"col-6",children:[e.jsx(g,{id:"label",label:V()}),e.jsx(C,{id:"label",register:s.register,placeholder:a("Form label"),defaultValue:l==="edit"&&!w(t)?t.label:"form name",errors:s.formState.errors,onChangeCapture:f=>{v&&s.setValue("name",he(pe(f.target.value)))},onClick:f=>{(f.target.value==="form_name"||f.target.value==="form name")&&s.resetField("label")},validate:{maxLength:{value:255,message:"max length is 255"}}})]}),e.jsxs("div",{className:"col-6",children:[e.jsx(g,{id:"name",label:a("Form name")}),e.jsx(C,{id:"name",register:s.register,placeholder:a("Form name"),defaultValue:l==="edit"&&!w(t)?t.name:"form_name",errors:s.formState.errors,isRequired:!0,onClick:f=>{(f.target.value==="form_name"||f.target.value==="form name")&&s.resetField("name")},validate:{validate:xe,required:a("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})]})]}),e.jsxs("div",{children:[e.jsx(g,{id:"action",label:a("Action")}),e.jsx(L,{id:"action",register:s.register,defaultValue:l==="edit"&&!w(t)?t.action:null,values:je,errors:s.formState.errors,validate:{required:a("This field is mandatory")}})]}),e.jsxs("div",{children:[e.jsx(g,{id:"outcome_message",label:a("Successful outcome message")}),e.jsx(C,{id:"meta.4.outcome_message",register:s.register,defaultValue:h(t,"outcome_message","The form was successfully submitted"),errors:s.formState.errors,isRequired:!0,validate:{required:a("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})]}),y()===A.PHP||y()===A.FILL_META&&e.jsxs("div",{children:[e.jsx(g,{id:"redirect_to",label:a("Redirect after form submission")}),e.jsx(C,{id:"meta.5.redirect_to",register:s.register,defaultValue:h(t,"redirect_to",""),errors:s.formState.errors,isRequired:!0,validate:{maxLength:{value:255,message:"max length is 255"}}})]}),y()===A.AJAX&&e.jsx(W,{record:t}),y()===A.CUSTOM&&e.jsx(J,{record:t}),y()===A.PHP&&e.jsx(K,{record:t}),y()===A.EMAIL&&e.jsx(Te,{record:t}),E()&&e.jsx(ee,{record:t,action:y()}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(q,{style:I.PRIMARY,testId:"save-form",type:"submit",children:a("Save")}),e.jsx(q,{style:I.DANGER,type:"button",onClick:()=>{b(!n)},children:a("Close")})]})]})})})}),l==="save"?e.jsx(q,{testId:"create-form",type:"button",onClick:()=>{b(!n)},style:o||I.PRIMARY,children:a("Create form")}):e.jsx("a",{className:i,href:"#",onClick:f=>{f.preventDefault(),b(!n)},children:a("Edit")})]})};ye.propTypes={mode:p.oneOf(["edit","save"]).isRequired,style:p.oneOf(Object.values(I)),record:p.object,classButton:p.string};export{ye as S};
