import{j as e,u as t}from"./fields-Cqw4NA-S.js";import{a as k,R as F,u as X}from"./vendor-D21mNUGX.js";import{P as w,u as I,B as b,s as v,n as Y,I as L,a as E,o as $,p as Z,q as V,r as ee,v as G,t as U,w as te,x as B,y as H,m as se,c as le,L as ae,z as ne,C as ie}from"./index-DxCcoVgy.js";import{u as R,a as q,b as M,c as oe,F as re}from"./index.esm-CunHohLK.js";import{n as N,s as ce,L as de}from"./Layout-DCNQQmUm.js";import{S as ue}from"./index-DYn0t4Hl.js";import{u as me,C as he,a as pe}from"./sortable.esm-C-GypyhB.js";import{I as xe}from"./InputHidden-D-OSbUvk.js";import{I as P}from"./Input-CuPRbCrx.js";import{T as O}from"./index-XHH1WL2a.js";import{M as _}from"./index-Dp8I9ahT.js";import{u as fe}from"./index-DRV1MUeg.js";import{g as je}from"./files-DkSZUltV.js";import"./index-Cwt3Qm9G.js";const z=({id:s,index:c})=>{const r=I(),[n,d]=k.useState(!1),{control:a}=R(),{remove:i}=q({control:a,name:"items"}),x=[e.jsx(b,{style:v.SUCCESS,onClick:m=>{m.preventDefault(),r(Y({id:s})),i(c),d(!n)},children:t("Yes")}),e.jsx(b,{style:v.DANGER,onClick:m=>{m.preventDefault(),d(!n)},children:t("No")})];return e.jsxs("span",{children:[e.jsx(_,{title:t("Confirm deleting option"),visible:n,buttons:x,children:t("Are you sure?")}),e.jsx("a",{href:"#",onClick:m=>{m.preventDefault(),d(!n)},children:e.jsx(O,{icon:!1,tip:t("Delete"),label:e.jsx(L,{icon:"bx-trash",width:18,color:"#F94144"})})})]})};z.propTypes={id:w.string.isRequired,index:w.number.isRequired};const W=({item:s,index:c})=>{const r=I(),{selectedElements:n}=E(u=>u.datasetState),d=()=>n.filter(Q=>Q.id===s.id).length>0,a=u=>`items.${c}.${u}`,{register:i,formState:{errors:x},control:m,setValue:D,resetField:h}=R(),f=M({control:m,name:a("value")}),g=M({control:m,name:a("label")}),{attributes:j,listeners:o,setNodeRef:l,transform:p}=me({id:s.id}),y={transform:he.Translate.toString(p)},S=()=>s.label==="label"&&s.value==="value"?!0:s.label===s.value,[C,T]=k.useState(S()),A=()=>f||(s.value?s.value:null),K=()=>g||(s.label?s.label:null);return e.jsxs(F.Fragment,{children:[e.jsx(xe,{id:a("id"),value:s.id,register:i}),e.jsxs("tr",{id:s.id,style:y,ref:l,children:[e.jsx("td",{children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("span",{className:"cursor-move top-2 handle",...j,...o,children:e.jsx(L,{icon:"bx:dots-vertical-rounded",color:"#777",width:18})}),e.jsx(O,{label:e.jsxs("label",{className:"checkbox",htmlFor:`select-${s.id}`,style:{top:"3px"},children:[e.jsx("input",{id:`select-${s.id}`,type:"checkbox",checked:d(),onChange:u=>{r($({element:s,selected:u.target.checked}))}}),e.jsx("span",{})]}),icon:!1,tip:t(d()?"Deselect this element":"Select this element")})]})}),e.jsx("td",{children:e.jsx(P,{id:a("label"),register:i,errors:x,defaultValue:K(),onChangeCapture:u=>{C&&D(a("value"),u.target.value)},onClick:u=>{s.label&&u.target.value==="label"&&h(a("label"))},validate:{required:t("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})}),e.jsx("td",{children:e.jsx(P,{id:a("value"),register:i,errors:x,defaultValue:A(),onChangeCapture:u=>{C&&D(a("label"),u.target.value)},onClick:u=>{s.value&&u.target.value==="value"&&h(a("value"))},validate:{required:t("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})}),e.jsx("td",{children:e.jsx(O,{label:e.jsx("button",{type:"button",className:`acpt-btn-switch ${C?"active":""}`,onClick:u=>{u.preventDefault(),T(!C)},children:e.jsx(L,{icon:"bx:bx-link",width:"18px"})}),tip:t(C?"Label and value are linked":"Label and value are unlinked"),icon:!1})}),e.jsx("td",{children:e.jsx("div",{className:"i-flex-center s-8",children:e.jsx(z,{id:s.id,index:c})})})]})]})};W.propTypes={item:w.object.isRequired,index:w.number.isRequired};const be=()=>{const s=I(),[c,r]=k.useState(!1),{unregister:n}=R(),d=[e.jsx(b,{style:v.SUCCESS,onClick:a=>{a.preventDefault(),s(Z()),n("items"),r(!c)},children:t("Yes")}),e.jsx(b,{style:v.DANGER,onClick:a=>{a.preventDefault(),r(!c)},children:t("No")})];return e.jsxs(F.Fragment,{children:[e.jsx(_,{title:t("Confirm deleting all"),visible:c,buttons:d,children:t("Are you sure?")}),e.jsx(b,{type:"button",style:v.DANGER,onClick:a=>{a.preventDefault(),r(!c)},children:t("Delete all")})]})},ve=()=>{const s=I(),{items:c,selectedElements:r}=E(o=>o.datasetState),{control:n,setValue:d,getValues:a}=R(),i=M({control:n,name:"items"}),{append:x,remove:m}=q({control:n,name:"items"}),D=k.useRef(null),[h,f]=k.useState(null),g=()=>{r.map(o=>{switch(h){case"duplicate":const l=G(),p={id:l,label:o.label,value:o.value,isDefault:!1,sort:i.length+1};s(U(p)),x({id:l,label:o.label,value:o.value});break;case"delete":const y=a("items").filter(S=>S.id!==o.id);d("items",y),s(Y({id:o.id}));break}}),s(V())},j=()=>r.length===c.length;if(r.length>0)return e.jsxs("div",{className:"flex-between",children:[e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsxs("span",{children:[r.length," ",t("Selected items")]}),e.jsx("span",{children:e.jsx("a",{href:"#",onClick:o=>{o.preventDefault(),o.stopPropagation(),j()?s(V()):s(ee())},children:t(j()?"deselect all":"select all")})})]}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsxs("select",{ref:D,className:"form-control sm",onChange:o=>{f(o.target.value!==""?o.target.value:null)},children:[e.jsx("option",{value:"",children:t("Select")}),e.jsx("option",{value:"duplicate",children:t("Duplicate")}),e.jsx("option",{value:"delete",children:t("Delete")})]}),e.jsx(b,{style:v.WHITE,size:"sm",disabled:h===null,onClick:o=>{o.preventDefault(),g()},children:t("Execute")})]})]})},J=({id:s})=>{const c=I(),r=async n=>{const d=["json","csv","yaml"],a=n.target.files[0],i=je(a.name),x=a.type;if(!d.includes(i))return;let m=await a.text();const D=new File([m],a.name,{type:x});let h=new FormData;h.append("id",s),h.append("file",D),c(te(h)).then(f=>{const g=f.payload;g.success===!0?(N.success(t("File was successfully imported")),c(B(s)).then(j=>{j.payload&&c(H(j.payload.items))}).catch(j=>{console.error(j)})):N.error(e.jsx("span",{dangerouslySetInnerHTML:{__html:g.error}}))}).catch(f=>{console.error(f),N(f)})};return e.jsxs(F.Fragment,{children:[e.jsx("input",{onChange:n=>r(n),style:{display:"none"},accept:"application/json, application/yaml,.csv,.yaml",name:"file",type:"file",id:"upload"}),e.jsx("label",{htmlFor:"upload",className:"acpt-btn acpt-btn acpt-btn-bordered",children:t("Import data")})]})};J.propTypes={id:w.string.isRequired};const Le=()=>{const s=document.globals;s.settings;const c=s.globals,{id:r}=X(),n=I(),{data:d,loading:a}=E(l=>l.fetchDataset),{items:i}=E(l=>l.datasetState),[x]=fe();k.useEffect(()=>{ce(),se(t("Manage dataset")),le("#/tools"),n(B(r)).then(l=>{l.payload&&n(H(l.payload.items))}).catch(l=>{console.error(l)})},[r]);const m=oe({mode:"all"}),{move:D}=q({control:m.control,name:"items"}),h=()=>{const l={id:G(),label:"label",value:"value",isDefault:!1,sort:i.length+1};n(U(l))},f=l=>{const{active:p,over:y}=l;if(p.id===y.id)return;const S=i.findIndex(A=>A.id===p.id),C=i.findIndex(A=>A.id===y.id),T=pe(i,S,C);D(S,C),n(ne(T))},g=l=>{i&&i.map(p=>{n($({element:p,selected:l}))})},j=l=>{n(ie({id:d.id,name:d.name,label:d.label,items:l.items?l.items:[],emptyItems:!0})).then(p=>{const y=p.payload;y.success?N.success(t("Dataset successfully saved")):N.error(y.error)})},o=[e.jsx(J,{id:r}),e.jsx(b,{style:v.SECONDARY,type:"button",onClick:()=>{h()},children:t("Add element")}),e.jsx(b,{testId:"save-form",style:v.PRIMARY,type:"submit",children:t("Save")}),e.jsx(be,{})];return a?e.jsx(ae,{}):e.jsx(re,{...m,children:e.jsx("form",{onSubmit:m.handleSubmit(j),children:e.jsx(de,{actions:o,title:t("Manage dataset"),crumbs:[{label:t("ACPT Tools"),link:"/tools"},{label:t("Dataset"),link:"/tools/dataset"},{label:t("Manage dataset")}],children:i&&i.length>0?e.jsxs("div",{className:"flex-column s-24",ref:x,children:[e.jsx(ve,{}),e.jsx("div",{className:"bg-white b-rounded with-shadow",children:e.jsxs("div",{className:"responsive",children:[e.jsxs("table",{className:`acpt-table ${c.is_rtl?"rtl":""}`,children:[e.jsxs("thead",{children:[e.jsx("th",{style:{width:"10px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"select-all",style:{marginLeft:"26px"},children:[e.jsx("input",{id:"select-all",type:"checkbox",onChange:l=>{g(l.target.checked)}}),e.jsx("span",{})]})}),e.jsx("th",{children:t("Label")}),e.jsx("th",{children:t("Value")}),e.jsx("th",{style:{width:"10px"}}),e.jsx("th",{style:{width:"10px"}})]}),e.jsx("tbody",{ref:x,children:e.jsx(ue,{onDragEnd:f,items:i,children:e.jsx(F.Fragment,{children:i.map((l,p)=>e.jsx(W,{index:p,item:l},l.id))})})})]}),e.jsx("div",{className:"p-24",children:e.jsx(b,{style:v.SECONDARY,type:"button",onClick:()=>{h()},children:t("Add element")})})]})})]}):e.jsx("div",{className:"p-24 bg-white with-shadow",children:e.jsxs("div",{className:"b-maxi b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:t('No elements saved, generate the first one clicking on "Add element" button')}),e.jsx("div",{children:e.jsx(b,{style:v.SECONDARY,type:"button",onClick:()=>{h()},children:t("Add element")})})]})})})})})};export{Le as default};
