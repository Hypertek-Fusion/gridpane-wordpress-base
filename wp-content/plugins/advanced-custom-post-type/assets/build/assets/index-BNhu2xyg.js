import{j as e,u as t}from"./fields-Cqw4NA-S.js";import{a as x,h as Y,R as _,L as P,u as H}from"./vendor-D21mNUGX.js";import{a as k,n as f,s as w,f as J,L as W}from"./Layout-DCNQQmUm.js";import{P as N,u as D,b as E,B as G,s as j,bp as z,F as S,H as O,G as F,ah as K,a as Q,m as X,c as Z,M as ee,L as se,J as te}from"./index-DxCcoVgy.js";import{B as R}from"./index-Cbo4wqr7.js";import{T}from"./index-XHH1WL2a.js";import{P as ne}from"./index-CEHVWT-1.js";import{F as C,E as I}from"./FieldGroupsModal-WonEmKbD.js";import{m as o}from"./metaTypes-Bb9tjSPe.js";import{E as ae}from"./index-CTAGjDz_.js";import{E as M}from"./index-B85TJfsV.js";import{u as L,c as ie,b as le,F as oe}from"./index.esm-CunHohLK.js";import{M as re}from"./index-Dp8I9ahT.js";import{B as ce}from"./index-zHYFC1LM.js";import{u as de}from"./index-DRV1MUeg.js";import"./index-Cwt3Qm9G.js";import"./index-WYQ2JGQs.js";import"./index-DUqbm7sl.js";import"./index-C8n7JnXF.js";import"./objectWithoutPropertiesLoose-D8pFLZ8M.js";import"./index-Dc6Ibt6o.js";const v=({page:n,id:p})=>{const l=document.globals.settings,{reset:c}=L(),s=D();l.length>0&&E(l,"key","records_per_page")!==""&&E(l,"key","records_per_page").value;const[i,y]=x.useState(!1),u=Y(),A=()=>{s(z(p)).then(h=>{const g=h.payload;g.success?(c(),k("Option page successfully deleted."),u("/option-pages"),S()):f.error(g.error)}).catch(h=>console.error(h))},m=[e.jsx(G,{style:j.DANGER,onClick:()=>{A()},children:t("Yes, delete it")}),e.jsx(G,{style:j.SECONDARY,onClick:()=>{y(!i)},children:t("Return back to list")})];return e.jsxs(_.Fragment,{children:[e.jsx(re,{title:t("Delete meta group"),buttons:m,visible:i,children:e.jsx("div",{children:t("You are going to delete this option page. Are you sure?")})}),e.jsx("a",{className:`color-${j.DANGER}`,href:"#",onClick:h=>{h.preventDefault(),y(!i)},children:t("Delete")})]})};v.propTypes={page:N.number.isRequired,id:N.string.isRequired};const $=x.memo(({record:n,page:p})=>{const{register:b}=L(),l=s=>`elements.${s}`,c=s=>{F("duplicateAction",{belongsTo:o.OPTION_PAGE,find:s}).then(i=>{i.success===!0?(k("Option pages successfully duplicated."),w(),S()):f.error(i.error)}).catch(i=>{console.error(i),f.error(t("Unknown error, please retry later"))})};return e.jsxs(_.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{style:{width:"24px"},children:e.jsxs("label",{className:"checkbox",htmlFor:l(n.id),children:[e.jsx("input",{type:"checkbox",id:l(n.id),name:l(n.id),defaultChecked:!1,...b(l(n.id))}),e.jsx("span",{})]})}),e.jsx("td",{"data-cy":"page-icon",children:e.jsx(ae,{value:n.icon})}),e.jsx("td",{"data-cy":"page-title",children:n.pageTitle}),e.jsx("td",{"data-cy":"page-type",children:e.jsx(M,{element:n})}),e.jsx("td",{"data-cy":"menu-title",children:n.menuTitle}),e.jsx("td",{"data-cy":"menu-slug",children:n.menuSlug}),e.jsx("td",{"data-cy":"position",children:n.position}),e.jsx("td",{children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(P,{to:`/register_meta?belongsTo=${o.OPTION_PAGE}&find=${n.menuSlug}`,children:t("Create")}),e.jsx(C,{find:n.menuSlug,belongsTo:o.OPTION_PAGE})]})}),e.jsx("td",{children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("a",{href:"#",onClick:s=>{s.preventDefault(),c(n.id)},children:t("Duplicate")}),e.jsx(v,{page:p,id:n.id}),e.jsx(I,{belongsTo:o.OPTION_PAGE,find:n.menuSlug}),e.jsx(P,{to:`/permissions/page/${n.menuSlug}/${n.id}`,className:"color-warning",children:t("Permissions")})]})})]}),n.children&&n.children.length>0&&n.children.map(s=>{if(!O(s.id,o.OPTION_PAGE))return e.jsx(_.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{style:{width:"24px"},children:e.jsxs("label",{className:"checkbox",htmlFor:l(s.id),children:[e.jsx("input",{type:"checkbox",id:l(s.id),name:l(s.id),defaultChecked:!1,...b(l(s.id))}),e.jsx("span",{})]})}),e.jsx("td",{}),e.jsx("td",{"data-cy":"page-title",children:e.jsxs("span",{className:"i-flex-center s-8",children:[e.jsx("span",{className:"line"}),e.jsx("span",{children:s.pageTitle})]})}),e.jsx("td",{"data-cy":"page-type",children:e.jsx(M,{element:s})}),e.jsx("td",{"data-cy":"menu-title",children:s.menuTitle}),e.jsx("td",{"data-cy":"menu-slug",children:s.menuSlug}),e.jsx("td",{"data-cy":"position",children:s.position}),e.jsx("td",{children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(P,{to:`/register_meta?belongsTo=${o.OPTION_PAGE}&find=${s.menuSlug}`,children:t("Create")}),e.jsx(C,{find:s.menuSlug,belongsTo:o.OPTION_PAGE})]})}),e.jsx("td",{children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("a",{href:"#",onClick:i=>{i.preventDefault(),c(s.id)},children:t("Duplicate")}),e.jsx(v,{page:p,id:s.id}),e.jsx(I,{belongsTo:o.OPTION_PAGE,find:s.menuSlug}),e.jsx(P,{to:`/permissions/page/${s.menuSlug}/${s.id}`,className:"color-warning",children:t("Permissions")})]})})]})})})]})});$.propTypes={record:N.object.isRequired,page:N.number.isRequired};const Re=()=>{const n=document.globals,p=n.settings;K(o.OPTION_PAGE);const[b,l]=x.useReducer(a=>a+1,0);de();const c=x.useRef(),s=ie({mode:"all"}),i=le({control:s.control,name:"elements"}),y=D(),{data:u,loading:A}=Q(a=>a.fetchOptionPages),{page:m}=H(),h=p.length>0&&E(p,"key","records_per_page")!==""?E(p,"key","records_per_page").value:20,g=Math.ceil(u.count/h);x.useEffect(()=>{X(t("Option pages")),Z("#/option-pages"),y(ee({page:m||1,perPage:h})).then(a=>{J()})},[m]),x.useEffect(()=>{(()=>{if(!i)return!1;let r=0;for(const[d,V]of Object.entries(i))V===!0&&r++;return r===Object.entries(i).length})()?c.current.checked=!0:c.current&&(c.current.checked=!1)},[i]),document.addEventListener("restoredElement",function(){l()});const q=a=>{s.reset(),a.belongsTo=o.OPTION_PAGE;const r=a.action;if(r)switch(r){case"hide":te(a);break;case"delete":case"duplicate":F("bulkActionsAction",a).then(d=>{if(d.success===!0){switch(a.action){case"delete":k("Option pages successfully deleted.");break;case"duplicate":k("Option pages successfully duplicated.");break}s.resetField("elements"),w(),S()}else f.error(d.error)}).catch(d=>{console.error(d),f.error(t("Unknown error, please retry later"))});break}},B=a=>{u.records.filter(r=>!O(r.id,o.OPTION_PAGE)).map(r=>{s.setValue(`elements.${r.id}`,a),r.children&&r.children.filter(d=>!O(d.id,o.OPTION_PAGE)).map(d=>{s.setValue(`elements.${d.id}`,a)})})},U=[e.jsx(R,{style:j.PRIMARY,to:"/option-pages-manage",children:t("Manage pages")})];return A?e.jsx(se,{}):e.jsx(oe,{...s,children:e.jsx("form",{onSubmit:s.handleSubmit(q),children:e.jsxs(W,{title:t("Option pages"),actions:U,crumbs:[{label:t("Option pages")}],children:[e.jsx(ce,{belongsTo:o.OPTION_PAGE}),u.records&&u.records.length>0?e.jsx("div",{className:"responsive with-shadow b-rounded",children:e.jsxs("table",{"data-cy":"pages-table",className:`acpt-table ${n.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"24px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"all",children:[e.jsx("input",{ref:c,type:"checkbox",id:"all",defaultChecked:!1,onClick:a=>B(a.currentTarget.checked)}),e.jsx("span",{})]})}),e.jsx("th",{}),e.jsx("th",{children:e.jsx(T,{tip:t("Taxonomy slug. The post name/slug. Used for various queries for taxonomy content."),label:t("The page title")})}),e.jsx("th",{children:t("Type")}),e.jsx("th",{children:e.jsx(T,{tip:t("Taxonomy slug. The post name/slug. Used for various queries for taxonomy content."),label:t("Menu title")})}),e.jsx("th",{children:e.jsx(T,{tip:t("The page slug (used to generate the page URL). Must be unique"),label:t("Menu slug")})}),e.jsx("th",{children:e.jsx(T,{tip:t("This number controls the position of this page in the admin menu"),label:t("Menu position")})}),e.jsx("th",{children:t("Field groups")}),e.jsx("th",{children:t("Actions")})]})}),e.jsx("tbody",{children:u.records&&u.records.map(a=>{if(!O(a.id,o.OPTION_PAGE))return e.jsx($,{page:m,record:a},a.id)})}),g>1&&e.jsx("tfoot",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:9,children:e.jsx(ne,{currentPage:m?parseInt(m):1,totalPages:g,baseLink:"/taxonomies"})})})})]})}):e.jsx("div",{className:"p-24 bg-white with-shadow",children:e.jsxs("div",{className:"b-maxi b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:t("No option pages found.")}),e.jsx("div",{children:e.jsx(R,{type:"button",style:j.SECONDARY,to:"/option-pages-manage",children:t("Register the first one")})})]})})]})})})};export{Re as default};
