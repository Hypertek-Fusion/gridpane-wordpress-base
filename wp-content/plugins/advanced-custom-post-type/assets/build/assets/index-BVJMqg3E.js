import{j as e,u as s}from"./fields-Cqw4NA-S.js";import{a as _,R as w,u as G}from"./vendor-D21mNUGX.js";import{L as V,n as N}from"./Layout-DCNQQmUm.js";import{u as C,a as P,b as B,c as U,F as z}from"./index.esm-CunHohLK.js";import{u as H}from"./index-DRV1MUeg.js";import{P as y,u as k,B as m,s as x,bs as $,I as W,a as D,bt as F,v as M,bu as T,bv as J,bw as K,m as Q,c as E,bx as X,by as Z,L as ee,bz as se}from"./index-DxCcoVgy.js";import{I}from"./InputHidden-D-OSbUvk.js";import{T as O}from"./index-XHH1WL2a.js";import{S as te}from"./Select-DQFFBRh5.js";import{M as q}from"./index-Dp8I9ahT.js";import"./index-Cwt3Qm9G.js";const Y=({id:l,index:u})=>{const n=k(),[c,h]=_.useState(!1),{control:a}=C(),{remove:b}=P({control:a,name:"items"}),r=[e.jsx(m,{style:x.SUCCESS,onClick:i=>{i.preventDefault(),n($({id:l})),b(u),h(!c)},children:s("Yes")}),e.jsx(m,{style:x.DANGER,onClick:i=>{i.preventDefault(),h(!c)},children:s("No")})];return e.jsxs("span",{children:[e.jsx(q,{title:s("Confirm deleting permission"),visible:c,buttons:r,children:s("Are you sure?")}),e.jsx("a",{href:"#",onClick:i=>{i.preventDefault(),h(!c)},children:e.jsx(O,{icon:!1,tip:s("Delete"),label:e.jsx(W,{icon:"bx-trash",width:18,color:"#F94144"})})})]})};Y.propTypes={id:y.string.isRequired,index:y.number.isRequired};const L=({item:l,index:u,entityId:n,permissions:c})=>{const h=k(),{selectedElements:a}=D(o=>o.permissionState),b=()=>a.filter(p=>p.id===l.id).length>0,r=o=>`items.${u}.${o}`,{register:i,formState:{errors:j}}=C();return e.jsxs(w.Fragment,{children:[e.jsx(I,{id:r("id"),value:l.id,register:i}),e.jsx(I,{id:r("entityId"),value:n,register:i}),e.jsxs("tr",{id:l.id,children:[e.jsx("td",{children:e.jsx(O,{label:e.jsxs("label",{className:"checkbox",htmlFor:`select-${l.id}`,children:[e.jsx("input",{id:`select-${l.id}`,type:"checkbox",checked:b(),onChange:o=>{h(F({element:l,selected:o.target.checked}))}}),e.jsx("span",{})]}),icon:!1,tip:s(b()?"Deselect this element":"Select this element")})}),e.jsx("td",{children:e.jsx("div",{style:{width:"200px"},children:e.jsx(te,{register:i,id:r("userRole"),values:document.globals.globals.roles,errors:j,defaultValue:l.userRole})})}),c.map(o=>{const p=r(`permissions.${o.value}`);return e.jsx("td",{style:c.length>4?{padding:"24px 8px"}:{},children:e.jsxs("label",{className:"checkbox",htmlFor:p,children:[e.jsx("input",{name:p,value:!0,defaultChecked:l.permissions[o.value]===!0,type:"checkbox",id:p,...i(p,{})}),e.jsx("span",{})]})})}),e.jsx("td",{children:e.jsx(Y,{id:l.id,index:u})})]})]})};L.propTypes={item:y.object.isRequired,index:y.number.isRequired,entityId:y.string.isRequired,permissions:y.array.isRequired};const le=()=>{const l=k(),{items:u,selectedElements:n}=D(d=>d.permissionState),{control:c,setValue:h,getValues:a}=C(),b=B({control:c,name:"items"}),{append:r,remove:i}=P({control:c,name:"items"}),j=_.useRef(null),[o,p]=_.useState(null),A=()=>{n.map(d=>{switch(o){case"duplicate":const S=M(),v={id:S,label:d.label,value:d.value,isDefault:!1,sort:b.length+1};l(T(v)),r({id:S,label:d.label,value:d.value});break;case"delete":const f=a("items").filter(t=>t.id!==d.id);h("items",f),l($({id:d.id}));break}}),l(J())};if(n.length>0)return e.jsxs("div",{className:"flex-between",children:[e.jsx("div",{className:"i-flex-center s-8",children:e.jsxs("span",{children:[n.length," ",s("Selected items")]})}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsxs("select",{ref:j,className:"form-control sm",onChange:d=>{p(d.target.value!==""?d.target.value:null)},children:[e.jsx("option",{value:"",children:s("Select")}),e.jsx("option",{value:"duplicate",children:s("Duplicate")}),e.jsx("option",{value:"delete",children:s("Delete")})]}),e.jsx(m,{style:x.WHITE,size:"sm",disabled:o===null,onClick:d=>{d.preventDefault(),A()},children:s("Execute")})]})]})},ie=()=>{const l=k(),[u,n]=_.useState(!1),{unregister:c}=C(),h=[e.jsx(m,{style:x.SUCCESS,onClick:a=>{a.preventDefault(),l(K()),c("items"),n(!u)},children:s("Yes")}),e.jsx(m,{style:x.DANGER,onClick:a=>{a.preventDefault(),n(!u)},children:s("No")})];return e.jsxs(w.Fragment,{children:[e.jsx(q,{title:s("Confirm deleting all"),visible:u,buttons:h,children:s("Are you sure?")}),e.jsx(m,{type:"button",style:x.DANGER,onClick:a=>{a.preventDefault(),n(!u)},children:s("Delete all")})]})},be=()=>{const l=document.globals;l.settings;const u=l.globals,n=k(),{data:c,loading:h}=D(t=>t.fetchPermission),{items:a}=D(t=>t.permissionState),[b]=H(),{type:r,entity:i,id:j}=G();_.useEffect(()=>{Q(s("Permissions")),r==="taxonomy"?E("#/taxonomies"):r==="page"&&E("#/option-pages"),n(X(j)).then(t=>{t.payload&&n(Z(t.payload))}).catch(t=>{console.error(t)})},[r,i,j]);const o=U({mode:"all"}),p=()=>{let t;r==="taxonomy"?t={edit:!0,manage:!0,assign:!0,delete:!0}:r==="page"?t={edit:!0,read:!0}:t={edit_s:!0,edit_private_s:!0,edit_published_s:!0,edit_others_s:!0,publish_s:!0,read_private_s:!0,delete_s:!0,delete_private_s:!0,delete_published_s:!0,delete_others_s:!0};const g={id:M(),entityId:j,userRole:"editor",permissions:t,sort:a.length+1};n(T(g))},A=t=>{a&&a.map(g=>{n(F({element:g,selected:t}))})},d=t=>{n(se({entityId:j,...t})).then(g=>{const R=g.payload;R.success?N.success(s("Permissions successfully saved")):N.error(R.error)})},S=[e.jsx(m,{style:x.SECONDARY,type:"button",onClick:()=>{p()},children:s("Add permission")}),e.jsx(m,{testId:"save-form",style:x.PRIMARY,type:"submit",children:s("Save")}),e.jsx(ie,{})];let v=[];const f=[];switch(r){case"post":f.push({label:s("Registered Custom Post Types"),link:"/"}),f.push({label:i,link:`/view/${i}`}),v=[{label:s("Edit"),value:"edit_s"},{label:s("Edit private"),value:"edit_private_s"},{label:s("Edit published"),value:"edit_published_s"},{label:s("Edit others"),value:"edit_others_s"},{label:s("Publish"),value:"publish_s"},{label:s("Read"),value:"read_private_s"},{label:s("Delete"),value:"delete_s"},{label:s("Delete private"),value:"delete_private_s"},{label:s("Delete published"),value:"delete_published_s"},{label:s("Delete others"),value:"delete_others_s"}];break;case"taxonomy":f.push({label:s("Registered Taxonomies"),link:"/taxonomies"}),f.push({label:i,link:`/view_taxonomy/${i}`}),v=[{label:s("Edit"),value:"edit"},{label:s("Manage"),value:"manage"},{label:s("Assign"),value:"assign"},{label:s("Delete"),value:"delete"}];break;case"page":f.push({label:s("Option pages"),link:"/option-pages"}),v=[{label:s("Edit"),value:"edit"},{label:s("Read"),value:"read"}];break}return f.push({label:`${s("Manage permissions of")} ${i}`}),h?e.jsx(ee,{}):e.jsx(z,{...o,children:e.jsx("form",{onSubmit:o.handleSubmit(d),children:e.jsx(V,{title:`${s("Manage permissions")} ${i}`,actions:S,crumbs:f,children:a&&a.length>0?e.jsxs("div",{className:"flex-column s-24",ref:b,children:[e.jsx(le,{}),e.jsx("div",{className:"bg-white b-rounded with-shadow",children:e.jsxs("div",{className:"responsive",children:[e.jsxs("table",{className:`acpt-table ${u.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"10px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"select-all",children:[e.jsx("input",{id:"select-all",type:"checkbox",onChange:t=>{A(t.target.checked)}}),e.jsx("span",{})]})}),e.jsx("th",{style:{width:"200px"},children:s("User role")}),v.map(t=>e.jsx("th",{style:v.length>4?{padding:"24px 8px"}:{},className:v.length>4?"font-sm":"",children:t.label})),e.jsx("th",{style:{width:"10px"}})]})}),e.jsx("tbody",{ref:b,children:a.map((t,g)=>e.jsx(L,{permissions:v,index:g,entityId:j,item:t},t.id))})]}),e.jsx("div",{className:"b-top-1 p-24",children:e.jsx(m,{style:x.SECONDARY,type:"button",onClick:()=>{p()},children:s("Add permission")})})]})})]}):e.jsx("div",{className:"p-24 bg-white with-shadow",children:e.jsxs("div",{className:"b-maxi b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:s("No permissions found.")}),e.jsx("div",{children:e.jsx(m,{style:x.SECONDARY,type:"button",onClick:()=>{p()},children:s("Add permission")})})]})})})})})};export{be as default};
